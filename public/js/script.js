function attachValidation(e,t,a){$("."+e).keyup(function(){validate($(this),t,a)})}function validate(e,t,a){e.val(Math.max(t,Math.min(a,~~e.val())))}function getHPDVs(e){return~~e.find(".at .dvs").val()%2*8+~~e.find(".df .dvs").val()%2*4+~~e.find(".sp .dvs").val()%2*2+~~e.find(1===gen?".sl .dvs":".sa .dvs").val()%2}function calcStats(e){for(var t=0;t<STATS.length;t++)calcStat(e,STATS[t])}function calcCurrentHP(e,t,a){var i=Math.ceil(a*t/100);e.find(".current-hp").val(i)}function calcPercentHP(e,t,a){var i=Math.floor(100*a/t);e.find(".percent-hp").val(i)}function autosetWeather(e,t){var a=$("input:radio[name='weather']:checked").val();switch(-1===lastAutoWeather.indexOf(a)&&(lastManualWeather=a,lastAutoWeather[1-t]=""),e){case"Drought":lastAutoWeather[t]="Sun",$("#sun").prop("checked",!0);break;case"Drizzle":lastAutoWeather[t]="Rain",$("#rain").prop("checked",!0);break;case"Sand Stream":lastAutoWeather[t]="Sand",$("#sand").prop("checked",!0);break;case"Snow Warning":lastAutoWeather[t]="Hail",$("#hail").prop("checked",!0);break;case"Desolate Land":lastAutoWeather[t]="Harsh Sunshine",$("#harsh-sunshine").prop("checked",!0);break;case"Primordial Sea":lastAutoWeather[t]="Heavy Rain",$("#heavy-rain").prop("checked",!0);break;case"Delta Stream":lastAutoWeather[t]="Strong Winds",$("#strong-winds").prop("checked",!0);break;default:lastAutoWeather[t]="";var i=""!==lastAutoWeather[1-t]?lastAutoWeather[1-t]:"";$("input:radio[name='weather'][value='"+i+"']").prop("checked",!0)}}function autosetTerrain(e,t){var a=$("input:checkbox[name='terrain']:checked").val()||"No terrain";switch(-1===lastAutoTerrain.indexOf(a)&&(lastManualTerrain=a,lastAutoTerrain[1-t]=""),$("input:checkbox[name='terrain']:checked").prop("checked",!1),e){case"Electric Surge":lastAutoTerrain[t]="Electric",$("#electric").prop("checked",!0);break;case"Grassy Surge":lastAutoTerrain[t]="Grassy",$("#grassy").prop("checked",!0);break;case"Misty Surge":lastAutoTerrain[t]="Misty",$("#misty").prop("checked",!0);break;case"Psychic Surge":lastAutoTerrain[t]="Psychic",$("#psychic").prop("checked",!0);break;default:lastAutoTerrain[t]="";var i=""!==lastAutoTerrain[1-t]?lastAutoTerrain[1-t]:lastManualTerrain;"No terrain"!==i&&$("input:checkbox[name='terrain'][value='"+i+"']").prop("checked",!0)}}function autosetStatus(e,t){var a=$(e+" .status").val();a!==lastAutoStatus[e]&&(lastManualStatus[e]=a),"Flame Orb"===t?(lastAutoStatus[e]="Burned",$(e+" .status").val("Burned"),$(e+" .status").change()):"Toxic Orb"===t?(lastAutoStatus[e]="Badly Poisoned",$(e+" .status").val("Badly Poisoned"),$(e+" .status").change()):(lastAutoStatus[e]="Healthy",a!==lastManualStatus[e]&&($(e+" .status").val(lastManualStatus[e]),$(e+" .status").change()))}function showFormes(e,t,a,i){var r=0;if("Blank Set"!==t){var s=setdex[a][t];-1!==s.item.indexOf("ite")&&-1===s.item.indexOf("ite Y")||"Groudon"===a&&-1!==s.item.indexOf("Red Orb")||"Kyogre"===a&&-1!==s.item.indexOf("Blue Orb")||"Meloetta"===a&&-1!==s.moves.indexOf("Relic Song")||"Rayquaza"===a&&-1!==s.moves.indexOf("Dragon Ascent")?r=1:-1!==s.item.indexOf("ite Y")&&(r=2)}var o=getSelectOptions(i.formes,!1,r);e.children("select").find("option").remove().end().append(o).change(),e.show()}function setSelectValueIfValid(e,t,a){e.val(0!==e.children("option[value='"+t+"']").length?t:a)}function Pokemon(e){if("string"==typeof e){this.name=e.substring(0,e.indexOf(" ("));var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")),a=pokedex[this.name];this.type1=a.t1,this.type2=a.t2&&void 0!==a.t2?a.t2:"",this.rawStats=[],this.boosts=[],this.stats=[],this.evs=[];var i=setdex[this.name][t];if(this.level=i.level,this.HPEVs=i.evs&&void 0!==i.evs.hp?i.evs.hp:0,gen<3){this.maxHP=~~((2*(a.bs.hp+15)+63)*this.level/100)+this.level+10}else if(1===a.bs.hp)this.maxHP=1;else{this.maxHP=~~((2*a.bs.hp+31+~~(this.HPEVs/4))*this.level/100)+this.level+10}this.curHP=this.maxHP,this.nature=i.nature;for(var r=0;r<STATS.length;r++){var s=STATS[r];if(this.boosts[s]=0,this.evs[s]=i.evs&&void 0!==i.evs[s]?i.evs[s]:0,gen<3){this.rawStats[s]=5+~~((2*(a.bs[s]+15)+63)*this.level/100)}else{var o=i.ivs&&void 0!==i.ivs[s]?i.ivs[s]:31,n=NATURES[this.nature],l=n[0]===s?1.1:n[1]===s?.9:1;this.rawStats[s]=~~((5+~~((2*a.bs[s]+o+~~(this.evs[s]/4))*this.level/100))*l)}}this.ability=i.ability&&void 0!==i.ability?i.ability:a.ab&&void 0!==a.ab?a.ab:"",this.item=i.item&&void 0!==i.item&&("Eviolite"===i.item||i.item.indexOf("ite")<0)?i.item:"",this.status="Healthy",this.toxicCounter=0,this.moves=[];for(r=0;r<4;r++){var c=i.moves[r],d=moves[c]||moves["(No Move)"];this.moves.push($.extend({},d,{name:0===d.bp?"(No Move)":c,bp:d.bp,type:d.type,category:d.category,isCrit:!!d.alwaysCrit,hits:d.isMultiHit?"Skill Link"===this.ability||"Grip Claw"===this.item?5:3:d.isTwoHit?2:1}))}this.weight=a.w}else{if(-1===(t=e.find("input.set-selector").val()).indexOf("("))this.name=t;else{var h=t.substring(0,t.indexOf(" ("));this.name=pokedex[h].formes?e.find(".forme").val():h}this.type1=e.find(".type1").val(),this.type2=e.find(".type2").val(),this.level=~~e.find(".level").val(),this.maxHP=~~e.find(".hp .total").text(),this.curHP=~~e.find(".current-hp").val(),this.HPEVs=~~e.find(".hp .evs").val(),this.rawStats=[],this.boosts=[],this.stats=[],this.evs=[];for(r=0;r<STATS.length;r++)this.rawStats[STATS[r]]=~~e.find("."+STATS[r]+" .total").text(),this.boosts[STATS[r]]=~~e.find("."+STATS[r]+" .boost").val(),this.evs[STATS[r]]=~~e.find("."+STATS[r]+" .evs").val();this.nature=e.find(".nature").val(),this.ability=e.find(".ability").val(),this.item=e.find(".item").val(),this.status=e.find(".status").val(),this.toxicCounter="Badly Poisoned"===this.status?~~e.find(".toxic-counter").val():0,this.moves=[getMoveDetails(e.find(".move1"),this.item),getMoveDetails(e.find(".move2"),this.item),getMoveDetails(e.find(".move3"),this.item),getMoveDetails(e.find(".move4"),this.item)],this.weight=+e.find(".weight").val()}}function getMoveDetails(e,t){var a=e.find("select.move-selector").val(),i=moves[a];if(gen>=7&&e.find("input.move-z").prop("checked")&&"zp"in i){var r=getZMoveName(a,i.type,t);return $.extend({},moves[r],{name:r,bp:1===moves[r].bp?i.zp:moves[r].bp,category:i.category,isCrit:e.find(".move-crit").prop("checked"),hits:1})}return $.extend({},i,{name:a,bp:~~e.find(".move-bp").val(),type:e.find(".move-type").val(),category:e.find(".move-cat").val(),isCrit:e.find(".move-crit").prop("checked"),hits:i.isMultiHit?~~e.find(".move-hits").val():i.isTwoHit?2:1})}function getZMoveName(e,t,a){return-1!==e.indexOf("Hidden Power")?"Breakneck Blitz":"Clanging Scales"===e&&"Kommonium Z"===a?"Clangorous Soulblaze":"Darkest Lariat"===e&&"Incinium Z"===a?"Malicious Moonsault":"Giga Impact"===e&&"Snorlium Z"===a?"Pulverizing Pancake":"Moongeist Beam"===e&&"Lunalium Z"===a?"Menacing Moonraze Maelstrom":"Photon Geyser"===e&&"Ultranecrozium Z"===a?"Light That Burns the Sky":"Play Rough"===e&&"Mimikium Z"===a?"Let's Snuggle Forever":"Psychic"===e&&"Mewnium Z"===a?"Genesis Supernova":"Sparkling Aria"===e&&"Primarium Z"===a?"Oceanic Operetta":"Spectral Thief"===e&&"Marshadium Z"===a?"Soul-Stealing 7-Star Strike":"Spirit Shackle"===e&&"Decidium Z"===a?"Sinister Arrow Raid":"Stone Edge"===e&&"Lycanium Z"===a?"Splintered Stormshards":"Sunsteel Strike"===e&&"Solganium Z"===a?"Searing Sunraze Smash":"Thunderbolt"===e&&"Aloraichium Z"===a?"Stoked Sparksurfer":"Thunderbolt"===e&&"Pikashunium Z"===a?"10,000,000 Volt Thunderbolt":"Volt Tackle"===e&&"Pikanium Z"===a?"Catastropika":ZMOVES_TYPING[t]}function Field(){var e,t,a=$("input:radio[name='format']:checked").val(),i=$("#gravity").prop("checked"),r=[$("#srL").prop("checked"),$("#srR").prop("checked")];2===gen?(t=[$("#gscSpikesL").prop("checked")?1:0,$("#gscSpikesR").prop("checked")?1:0],e=$("input:radio[name='gscWeather']:checked").val()):(e=$("input:radio[name='weather']:checked").val(),t=[~~$("input:radio[name='spikesL']:checked").val(),~~$("input:radio[name='spikesR']:checked").val()]);var s=$("input:checkbox[name='terrain']:checked").val()?$("input:checkbox[name='terrain']:checked").val():"",o=[$("#reflectL").prop("checked"),$("#reflectR").prop("checked")],n=[$("#lightScreenL").prop("checked"),$("#lightScreenR").prop("checked")],l=[$("#protectL").prop("checked"),$("#protectR").prop("checked")],c=[$("#leechSeedL").prop("checked"),$("#leechSeedR").prop("checked")],d=[$("#foresightL").prop("checked"),$("#foresightR").prop("checked")],h=[$("#helpingHandR").prop("checked"),$("#helpingHandL").prop("checked")],p=[$("#friendGuardL").prop("checked"),$("#friendGuardR").prop("checked")],m=[$("#auroraVeilL").prop("checked"),$("#auroraVeilR").prop("checked")];this.getWeather=function(){return e},this.clearWeather=function(){e=""},this.getSide=function(u){return new Side(a,s,e,i,r[u],t[u],o[u],n[u],l[u],c[1-u],c[u],d[u],h[u],p[u],m[u])}}function Side(e,t,a,i,r,s,o,n,l,c,d,h,p,m,u){this.format=e,this.terrain=t,this.weather=a,this.isGravity=i,this.isSR=r,this.spikes=s,this.isReflect=o,this.isLightScreen=n,this.isProtected=l,this.isAttackerSeeded=c,this.isDefenderSeeded=d,this.isForesight=h,this.isHelpingHand=p,this.isFriendGuard=m,this.isAuroraVeil=u}function clearField(){$("#singles-format").prop("checked",!0),$("#clear").prop("checked",!0),$("#gscClear").prop("checked",!0),$("#gravity").prop("checked",!1),$("#srL").prop("checked",!1),$("#srR").prop("checked",!1),$("#spikesL0").prop("checked",!0),$("#spikesR0").prop("checked",!0),$("#gscSpikesL").prop("checked",!1),$("#gscSpikesR").prop("checked",!1),$("#reflectL").prop("checked",!1),$("#reflectR").prop("checked",!1),$("#lightScreenL").prop("checked",!1),$("#lightScreenR").prop("checked",!1),$("#protectL").prop("checked",!1),$("#protectR").prop("checked",!1),$("#leechSeedL").prop("checked",!1),$("#leechSeedR").prop("checked",!1),$("#foresightL").prop("checked",!1),$("#foresightR").prop("checked",!1),$("#helpingHandL").prop("checked",!1),$("#helpingHandR").prop("checked",!1),$("#friendGuardL").prop("checked",!1),$("#friendGuardR").prop("checked",!1),$("#auroraVeilL").prop("checked",!1),$("#auroraVeilR").prop("checked",!1),$("input:checkbox[name='terrain']").prop("checked",!1)}function getSetOptions(e=pokedex){var t=Object.keys(e);t.sort();for(var a=[],i=0;i<t.length;i++){var r=t[i];if(a.push({pokemon:r,text:r}),r in setdex)for(var s=Object.keys(setdex[r]),o=0;o<s.length;o++){var n=s[o];a.push({pokemon:r,set:n,text:r+" ("+n+")",id:r+" ("+n+")"})}a.push({pokemon:r,set:"Blank Set",text:r+" (Blank Set)",id:r+" (Blank Set)"})}return a}function getSelectOptions(e,t){t&&e.sort();for(var a="",i=0;i<e.length;i++)a+='<option value="'+e[i]+'">'+e[i]+"</option>";return a}function isGrounded(e){return $("#gravity").prop("checked")||"Flying"!==e.find(".type1").val()&&"Flying"!==e.find(".type2").val()&&"Levitate"!==e.find(".ability").val()&&"Air Balloon"!==e.find(".item").val()}function getTerrainEffects(){var e=$(this).prop("className");switch(e=e.substring(0,e.indexOf(" "))){case"type1":case"type2":case"item":var t=$(this).closest(".poke-info").prop("id");"Electric"===(a=$("input:checkbox[name='terrain']:checked").val())?$("#"+t).find("[value='Asleep']").prop("disabled",isGrounded($("#"+t))):"Misty"===a&&$("#"+t).find(".status").prop("disabled",isGrounded($("#"+t)));break;case"ability":var a;"Electric"===(a=$("input:checkbox[name='terrain']:checked").val())?($("#p1").find(".status").prop("disabled",!1),$("#p2").find(".status").prop("disabled",!1),$("#p1").find("[value='Asleep']").prop("disabled",isGrounded($("#p1"))),$("#p2").find("[value='Asleep']").prop("disabled",isGrounded($("#p2")))):"Misty"===a?($("#p1").find(".status").prop("disabled",isGrounded($("#p1"))),$("#p2").find(".status").prop("disabled",isGrounded($("#p2")))):($("#p1").find("[value='Asleep']").prop("disabled",!1),$("#p1").find(".status").prop("disabled",!1),$("#p2").find("[value='Asleep']").prop("disabled",!1),$("#p2").find(".status").prop("disabled",!1));break;default:$("input:checkbox[name='terrain']").not(this).prop("checked",!1),$(this).prop("checked")&&"Electric"===$(this).val()?($("#p1").find(".status").prop("disabled",!1),$("#p2").find(".status").prop("disabled",!1),$("#p1").find("[value='Asleep']").prop("disabled",isGrounded($("#p1"))),$("#p2").find("[value='Asleep']").prop("disabled",isGrounded($("#p2")))):$(this).prop("checked")&&"Misty"===$(this).val()?($("#p1").find(".status").prop("disabled",isGrounded($("#p1"))),$("#p2").find(".status").prop("disabled",isGrounded($("#p2")))):($("#p1").find("[value='Asleep']").prop("disabled",!1),$("#p1").find(".status").prop("disabled",!1),$("#p2").find("[value='Asleep']").prop("disabled",!1),$("#p2").find(".status").prop("disabled",!1))}}function loadDefaultList(){$(".set-selector").select2({formatResult:function(e){return e.set?"&nbsp;&nbsp;&nbsp;"+e.set:"<b>"+e.text+"</b>"},query:function(e){var t=_.filter(getSetOptions(),function(t){var a=t.pokemon.toUpperCase();return!e.term||e.term.toUpperCase().split(" ").every(function(e){return 0===a.indexOf(e)||a.indexOf("-"+e)>=0||a.indexOf(" "+e)>=0})});e.callback({results:t.slice(30*(e.page-1),30*e.page),more:t.length>=30*e.page})},initSelection:function(e,t){t("")}})}function loadCustomList(){getSetOptions(customSets);$("#p1 .set-selector").select2({formatResult:function(e){return e.pokemon},query:function(e){var t=_.filter(getSetOptions(),function(e){if("Custom Set"===e.set)return e.pokemon});e.callback({results:t,more:t.length>=20*e.page})},initSelection:function(e,t){t("")}})}function calculate(){var e=new Pokemon($("#p1")),t=new Pokemon($("#p2")),a=[e,t];e.maxDamages=[],t.maxDamages=[];var i=new Field;damageResults=calculateAllMoves(e,t,i);for(var r,s,o,n,l,c,d=e.stats[SP]>t.stats[SP]?0:e.stats[SP]===t.stats[SP]?"tie":1,h=-1,p=0;p<4;p++){s=(r=damageResults[0][p]).damage[0]*e.moves[p].hits,o=r.damage[r.damage.length-1]*e.moves[p].hits,e.maxDamages.push({moveOrder:p,maxDamage:o}),e.maxDamages.sort(function(e,t){return e.maxDamage<t.maxDamage}),n="%"===notation?Math.floor(1e3*s/t.maxHP)/10:Math.floor(48*s/t.maxHP),l="%"===notation?Math.floor(1e3*o/t.maxHP)/10:Math.floor(48*o/t.maxHP),r.damageText=s+"-"+o+" ("+n+" - "+l+notation+")",r.koChanceText=0===e.moves[p].bp?"nice move":getKOChanceText(r.damage,e,t,i.getSide(1),e.moves[p],e.moves[p].hits,"Bad Dreams"===e.ability);var m="";$(resultLocations[0][p].move+" + label").text(e.moves[p].name.replace("Hidden Power","HP")),$(resultLocations[0][p].damage).text(n+" - "+l+notation+m);m="";if(s=(r=damageResults[1][p]).damage[0]*t.moves[p].hits,o=r.damage[r.damage.length-1]*t.moves[p].hits,t.maxDamages.push({moveOrder:p,maxDamage:o}),t.maxDamages.sort(function(e,t){return e.maxDamage<t.maxDamage}),n="%"===notation?Math.floor(1e3*s/e.maxHP)/10:Math.floor(48*s/e.maxHP),l="%"===notation?Math.floor(1e3*o/e.maxHP)/10:Math.floor(48*o/e.maxHP),r.damageText=s+"-"+o+" ("+n+" - "+l+notation+")",r.koChanceText=0===t.moves[p].bp?"nice move":getKOChanceText(r.damage,t,e,i.getSide(0),t.moves[p],t.moves[p].hits,"Bad Dreams"===t.ability),$(resultLocations[1][p].move+" + label").text(t.moves[p].name.replace("Hidden Power","HP")),$(resultLocations[1][p].damage).text(n+" - "+l+notation+m),"tie"===d)o>h&&(h=o,c=$(resultLocations[0][p].move));else{var u=a[d].maxDamages[0].moveOrder;c=$(resultLocations[d][u].move)}}$(".locked-move").length?c=$(".locked-move"):stickyMoves.setSelectedMove(c.prop("id")),c.prop("checked",!0),c.change(),$("#resultHeaderL").text(e.name+"'s Moves (select one to show detailed results)"),$("#resultHeaderR").text(t.name+"'s Moves (select one to show detailed results)")}function changeSprite(e,t){var a="./pkm-sprites/"+e.toLowerCase()+".png";$("#sprite"+t).attr("src")!=a&&$("#sprite"+t).attr("src",a)}function updateBar(e,t,a){$("#myBar1").css("width","100%"),$("#myBar1-max").css("width","100%"),$("#myBar1").removeClass("ko-d"),$("#myBar1").html("&nbsp"),$("#myBar2").css("width","100%"),$("#myBar2-max").css("width","100%"),$("#myBar2").removeClass("ko-d"),$("#myBar2").html("&nbsp"),1==a?t<=0&&e<=0?($("#myBar2").css("width","100%"),$("#myBar2-max").css("width","0%"),$("#myBar2").text("KO'd!"),$("#myBar2").addClass("ko-d")):t<=0?($("#myBar2").css("width",e+"%"),$("#myBar2-max").css("width","0%")):($("#myBar2").css("width",e+"%"),$("#myBar2-max").css("width",t+"%")):t<=0&&e<=0?($("#myBar1").css("width","100%"),$("#myBar1-max").css("width","0%"),$("#myBar1").text("KO'd!"),$("#myBar1").addClass("ko-d")):t<=0?($("#myBar1").css("width",e+"%"),$("#myBar1-max").css("width","0%")):($("#myBar1").css("width",e+"%"),$("#myBar1-max").css("width",t+"%"))}function findDamageResult(e){for(var t="#"+e.attr("id"),a=0;a<resultLocations.length;a++)for(var i=0;i<resultLocations[a].length;i++)if(resultLocations[a][i].move===t)return damageResults[a][i]}function CALCULATE_ALL_MOVES_BW(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),e.stats[DF]=getModifiedStat(e.rawStats[DF],e.boosts[DF]),e.stats[SD]=getModifiedStat(e.rawStats[SD],e.boosts[SD]),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[DF]=getModifiedStat(t.rawStats[DF],t.boosts[DF]),t.stats[SD]=getModifiedStat(t.rawStats[SD],t.boosts[SD]),t.stats[SP]=getFinalSpeed(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),checkDownload(t,e),e.stats[AT]=getModifiedStat(e.rawStats[AT],e.boosts[AT]),e.stats[SA]=getModifiedStat(e.rawStats[SA],e.boosts[SA]),t.stats[AT]=getModifiedStat(t.rawStats[AT],t.boosts[AT]),t.stats[SA]=getModifiedStat(t.rawStats[SA],t.boosts[SA]);var i=a.getSide(1),r=a.getSide(0);checkInfiltrator(e,i),checkInfiltrator(t,r);for(var s=[[],[]],o=0;o<4;o++)s[0][o]=getDamageResult(e,t,e.moves[o],i),s[1][o]=getDamageResult(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_BW(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[DF]=getModifiedStat(t.rawStats[DF],t.boosts[DF]),t.stats[SD]=getModifiedStat(t.rawStats[SD],t.boosts[SD]),t.stats[SP]=getFinalSpeed(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),e.stats[AT]=getModifiedStat(e.rawStats[AT],e.boosts[AT]),e.stats[SA]=getModifiedStat(e.rawStats[SA],e.boosts[SA]),t.stats[AT]=getModifiedStat(t.rawStats[AT],t.boosts[AT]);var i=a.getSide(~~("one-vs-all"===mode));checkInfiltrator(e,i);for(var r=[],s=0;s<4;s++)r[s]=getDamageResult(e,t,e.moves[s],i);return r}function getDamageResult(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};if(i.isProtected&&!a.bypassesProtect&&!a.isZ)return r.isProtected=!0,{damage:[0],description:buildDescription(r)};var s=t.ability;-1===["Full Metal Body","Prism Armor","Shadow Shield"].indexOf(s)&&(-1!==["Mold Breaker","Teravolt","Turboblaze"].indexOf(e.ability)&&(s="",r.attackerAbility=e.ability),"Menacing Moonraze Maelstrom"!==a.name&&"Moongeist Beam"!==a.name&&"Searing Sunraze Smash"!==a.name&&"Sunsteel Strike"!==a.name||(s=""));var o=a.isCrit&&-1===["Battle Armor","Shell Armor"].indexOf(s);if("Weather Ball"===a.name)a.type=-1!==i.weather.indexOf("Sun")?"Fire":-1!==i.weather.indexOf("Rain")?"Water":"Sand"===i.weather?"Rock":"Hail"===i.weather?"Ice":"Normal",r.weather=i.weather,r.moveType=a.type;else if("Judgment"===a.name&&-1!==e.item.indexOf("Plate"))a.type=getItemBoostType(e.item);else if("Techno Blast"===a.name&&-1!==e.item.indexOf("Drive"))a.type=getTechnoBlast(e.item);else if("Multi-Attack"===a.name&&-1!==e.item.indexOf("Memory"))a.type=getMultiAttack(e.item);else if("Natural Gift"===a.name&&-1!==e.item.indexOf("Berry")){var n=getNaturalGift(e.item);a.type=n.t,a.bp=n.p,r.attackerItem=e.item,r.moveBP=a.bp,r.moveType=a.type}else"Nature Power"===a.name?a.type="Electric"===i.terrain?"Electric":"Grassy"===i.terrain?"Grass":"Misty"===i.terrain?"Fairy":"Psychic"===i.terrain?"Psychic":"Normal":"Revelation Dance"==a.name&&(a.type=e.type1);var l=!1,c=!1,d=!1,h=!1,p=!1;a.isZ||(l="Aerilate"===e.ability&&"Normal"===a.type,c="Pixilate"===e.ability&&"Normal"===a.type,d="Refrigerate"===e.ability&&"Normal"===a.type,h="Galvanize"===e.ability&&"Normal"===a.type,p="Liquid Voice"===e.ability&&a.isSound,l?a.type="Flying":h?a.type="Electric":p?a.type="Water":c?a.type="Fairy":d?a.type="Ice":"Normalize"===e.ability&&(a.type="Normal",r.attackerAbility=e.ability)),("Gale Wings"!==e.ability||"Flying"!==a.type||gen>=7&&e.curHP!==e.maxHP)&&("Triage"!==e.ability||!a.givesHealth)||(a.hasPriority=!0,r.attackerAbility=e.ability);var m=getMoveEffectiveness(a,t.type1,"Scrappy"===e.ability||i.isForesight,i.isGravity),u=t.type2?getMoveEffectiveness(a,t.type2,"Scrappy"===e.ability||i.isForesight,i.isGravity):1,f=m*u,y=""===t.item||"Giratina-Origin"===t.name&&"Griseous Orb"===t.item||-1!==t.name.indexOf("Arceus")&&-1!==t.item.indexOf("Plate")||-1!==t.name.indexOf("Genesect")&&-1!==t.item.indexOf("Drive")||-1!==t.ability.indexOf("RKS System")&&-1!==t.item.indexOf("Memory")||-1!==t.item.indexOf(" Z");if(0===f&&"Thousand Arrows"===a.name&&(f=1),"Ring Target"===t.item&&0===f&&(0===typeChart[a.type][t.type1]?f=u:0===typeChart[a.type][t.type2]&&(f=m)),0===f)return{damage:[0],description:buildDescription(r)};if("Sky Drop"===a.name&&("Flying"===t.type1||"Flying"===t.type2||gen>=6&&t.weight>=200||i.isGravity))return{damage:[0],description:buildDescription(r)};if("Synchronoise"===a.name&&-1===[t.type1,t.type2].indexOf(e.type1)&&(!e.type2||-1===[t.type1,t.type2].indexOf(e.type2)))return{damage:[0],description:buildDescription(r)};if("Dream Eater"===a.name&&"Asleep"!==t.status&&"Comatose"!==t.ability)return{damage:[0],description:buildDescription(r)};if("Wonder Guard"===s&&f<=1||"Grass"===a.type&&"Sap Sipper"===s||"Fire"===a.type&&-1!==s.indexOf("Flash Fire")||"Water"===a.type&&-1!==["Dry Skin","Storm Drain","Water Absorb"].indexOf(s)||"Electric"===a.type&&-1!==["Lightning Rod","Motor Drive","Volt Absorb"].indexOf(s)||"Ground"===a.type&&!i.isGravity&&"Thousand Arrows"!==a.name&&"Levitate"===s||a.isBullet&&"Bulletproof"===s||a.isSound&&"Soundproof"===s||a.hasPriority&&-1!==["Queenly Majesty","Dazzling"].indexOf(s))return r.defenderAbility=s,{damage:[0],description:buildDescription(r)};if("Strong Winds"===i.weather&&("Flying"===t.type1||"Flying"===t.type2)&&typeChart[a.type].Flying>1&&(f/=2,r.weather=i.weather),"Ground"===a.type&&"Thousand Arrows"!==a.name&&!i.isGravity&&"Air Balloon"===t.item)return r.defenderItem=t.item,{damage:[0],description:buildDescription(r)};if(a.hasPriority&&"Psychic"===i.terrain&&isGroundedForCalc(t,i))return r.terrain=i.terrain,{damage:[0],description:buildDescription(r)};if(r.HPEVs=t.HPEVs+" HP","Seismic Toss"===a.name||"Night Shade"===a.name){var S=e.level;return"Parental Bond"===e.ability&&(S*=2),{damage:[S],description:buildDescription(r)}}if("Final Gambit"===a.name){return{damage:[e.curHP],description:buildDescription(r)}}a.hits>1&&(r.hits=a.hits);var v,b=e.stats[SP]>t.stats[SP]?"FIRST":"LAST";switch(a.name){case"Payback":v="LAST"===b?100:50,r.moveBP=v;break;case"Electro Ball":var g=Math.floor(e.stats[SP]/t.stats[SP]);v=g>=4?150:g>=3?120:g>=2?80:60,r.moveBP=v;break;case"Gyro Ball":v=Math.min(150,Math.floor(25*t.stats[SP]/e.stats[SP])),r.moveBP=v;break;case"Punishment":v=Math.min(200,60+20*countBoosts(t.boosts)),r.moveBP=v;break;case"Low Kick":case"Grass Knot":var k=t.weight;v=k>=200?120:k>=100?100:k>=50?80:k>=25?60:k>=10?40:20,r.moveBP=v;break;case"Hex":v=a.bp*("Healthy"!==t.status?2:1),r.moveBP=v;break;case"Heavy Slam":case"Heat Crash":var A=e.weight/t.weight;v=A>=5?120:A>=4?100:A>=3?80:A>=2?60:40,r.moveBP=v;break;case"Stored Power":case"Power Trip":v=20+20*countBoosts(e.boosts),r.moveBP=v;break;case"Acrobatics":v="Flying Gem"===e.item||""===e.item?110:55,r.moveBP=v;break;case"Wake-Up Slap":v=a.bp*("Asleep"===t.status?2:1),r.moveBP=v;break;case"Weather Ball":v=""!==i.weather?100:50,r.moveBP=v;break;case"Fling":v=getFlingPower(e.item),r.moveBP=v,r.attackerItem=e.item;break;case"Eruption":case"Water Spout":v=Math.max(1,Math.floor(150*e.curHP/e.maxHP)),r.moveBP=v;break;case"Flail":case"Reversal":var M=Math.floor(48*e.curHP/e.maxHP);v=M<=1?200:M<=4?150:M<=9?100:M<=16?80:M<=32?40:20,r.moveBP=v;break;case"Nature Power":v="Electric"===i.terrain||"Grassy"===i.terrain||"Psychic"===i.terrain?90:"Misty"===i.terrain?95:80;break;case"Water Shuriken":v="Greninja-Ash"===e.name?20:15,r.moveBP=v;break;case"Wring Out":v=Math.max(1,Math.ceil(120*t.curHP/t.maxHP-.5)),r.moveBP=v;break;default:v=a.bp}var P=[];"Technician"===e.ability&&v<=60||"Flare Boost"===e.ability&&"Burned"===e.status&&"Special"===a.category||"Toxic Boost"===e.ability&&("Poisoned"===e.status||"Badly Poisoned"===e.status)&&"Physical"===a.category?(P.push(6144),r.attackerAbility=e.ability):"Analytic"===e.ability&&"FIRST"!==b?(P.push(5325),r.attackerAbility=e.ability):"Sand Force"===e.ability&&"Sand"===i.weather&&-1!==["Rock","Ground","Steel"].indexOf(a.type)?(P.push(5325),r.attackerAbility=e.ability,r.weather=i.weather):("Reckless"===e.ability&&a.hasRecoil||"Iron Fist"===e.ability&&a.isPunch)&&(P.push(4915),r.attackerAbility=e.ability),"Heatproof"===s&&"Fire"===a.type?(P.push(2048),r.defenderAbility=s):"Dry Skin"===s&&"Fire"===a.type?(P.push(5120),r.defenderAbility=s):"Fluffy"!==s||a.makesContact&&"Long Reach"!==e.ability||"Fire"!==a.type?"Fluffy"===s&&a.makesContact&&"Long Reach"!==e.ability&&"Fire"!==a.type&&(P.push(2048),r.defenderAbility=s):(P.push(8192),r.defenderAbility=s),"Sheer Force"===e.ability&&a.hasSecondaryEffect&&(P.push(5325),r.attackerAbility=e.ability),getItemBoostType(e.item)===a.type?(P.push(4915),r.attackerItem=e.item):"Muscle Band"===e.item&&"Physical"===a.category||"Wise Glasses"===e.item&&"Special"===a.category?(P.push(4505),r.attackerItem=e.item):!("Adamant Orb"===e.item&&"Dialga"===e.name||"Lustrous Orb"===e.item&&"Palkia"===e.name||"Griseous Orb"===e.item&&"Giratina-Origin"===e.name)||a.type!==e.type1&&a.type!==e.type2?e.item===a.type+" Gem"?(P.push(gen>=6?5325:6144),r.attackerItem=e.item):!("Soul Dew"===e.item&&"Latios"===e.name||"Soul Dew"===e.item&&"Latios-Mega"===e.name||"Soul Dew"===e.item&&"Latias"===e.name||"Soul Dew"===e.item&&"Latias-Mega"===e.name)||a.type!==e.type1&&a.type!==e.type2||(P.push(gen>=7?4915:4096),r.attackerItem=e.item):(P.push(4915),r.attackerItem=e.item),"Facade"===a.name&&-1!==["Burned","Paralyzed","Poisoned","Badly Poisoned"].indexOf(e.status)||"Brine"===a.name&&t.curHP<=t.maxHP/2||"Venoshock"===a.name&&("Poisoned"===t.status||"Badly Poisoned"===t.status)?(P.push(8192),r.moveBP=2*a.bp):"Solar Beam"===a.name&&-1!==["Rain","Heavy Rain","Sand","Hail"].indexOf(i.weather)?(P.push(2048),r.moveBP=a.bp/2,r.weather=i.weather):gen>=6&&"Knock Off"===a.name&&!y?(P.push(6144),r.moveBP=1.5*a.bp):-1!==["Breakneck Blitz","Bloom Doom","Inferno Overdrive","Hydro Vortex","Gigavolt Havoc","Subzero Slammer","Supersonic Skystrike","Savage Spin-Out","Acid Downpour","Tectonic Rage","Continental Crush","All-Out Pummeling","Shattered Psyche","Never-Ending Nightmare","Devastating Drake","Black Hole Eclipse","Corkscrew Crash","Twinkle Tackle"].indexOf(a.name)&&(r.moveBP=a.bp),i.isHelpingHand&&(P.push(6144),r.isHelpingHand=!0),l||c||d||h?(P.push(gen>=7?4915:5325),r.attackerAbility=e.ability):"Mega Launcher"===e.ability&&a.isPulse||"Strong Jaw"===e.ability&&a.isBite?(P.push(6144),r.attackerAbility=e.ability):"Tough Claws"===e.ability&&a.makesContact?(P.push(5325),r.attackerAbility=e.ability):"Neuroforce"===e.ability&&f>1&&(P.push(4915),r.attackerAbility=e.ability);var T=e.ability===a.type+" Aura",x=s===a.type+" Aura";(T||x)&&("Aura Break"===e.ability||"Aura Break"===s?(P.push(3072),r.attackerAbility=e.ability,r.defenderAbility=s):(P.push(5447),T&&(r.attackerAbility=e.ability),x&&(r.defenderAbility=s))),v=Math.max(1,pokeRound(v*chainMods(P)/4096));var D,w="Foul Play"===a.name?t:e;a.usesHighestAttackStat&&(a.category=w.stats[AT]>=w.stats[SA]?"Physical":"Special");var $="Physical"===a.category?AT:SA;r.attackEVs=e.evs[$]+(NATURES[e.nature][0]===$?"+":NATURES[e.nature][1]===$?"-":"")+" "+toSmogonStat($),0===w.boosts[$]||o&&w.boosts[$]<0?D=w.rawStats[$]:"Unaware"===s?(D=w.rawStats[$],r.defenderAbility=s):(D=w.stats[$],r.attackBoost=w.boosts[$]),"Hustle"===e.ability&&"Physical"===a.category&&(D=pokeRound(3*D/2),r.attackerAbility=e.ability);var E=[];("Thick Fat"===s&&("Fire"===a.type||"Ice"===a.type)||"Water Bubble"===s&&"Fire"===a.type)&&(E.push(2048),r.defenderAbility=s),"Guts"===e.ability&&"Healthy"!==e.status&&"Physical"===a.category||"Overgrow"===e.ability&&e.curHP<=e.maxHP/3&&"Grass"===a.type||"Blaze"===e.ability&&e.curHP<=e.maxHP/3&&"Fire"===a.type||"Torrent"===e.ability&&e.curHP<=e.maxHP/3&&"Water"===a.type||"Swarm"===e.ability&&e.curHP<=e.maxHP/3&&"Bug"===a.type||"Special"===a.category&&("Plus"===e.ability||"Minus"===e.ability)?(E.push(6144),r.attackerAbility=e.ability):"Flash Fire (activated)"===e.ability&&"Fire"===a.type?(E.push(6144),r.attackerAbility="Flash Fire"):"Solar Power"===e.ability&&-1!==i.weather.indexOf("Sun")&&"Special"===a.category||"Flower Gift"===e.ability&&-1!==i.weather.indexOf("Sun")&&"Physical"===a.category?(E.push(6144),r.attackerAbility=e.ability,r.weather=i.weather):"Defeatist"===e.ability&&e.curHP<=e.maxHP/2||"Slow Start"===e.ability&&"Physical"===a.category?(E.push(2048),r.attackerAbility=e.ability):"Huge Power"!==e.ability&&"Pure Power"!==e.ability||"Physical"!==a.category||(E.push(8192),r.attackerAbility=e.ability),"Thick Club"===e.item&&("Cubone"===e.name||"Marowak"===e.name||"Marowak-Alola"===e.name)&&"Physical"===a.category||"Deep Sea Tooth"===e.item&&"Clamperl"===e.name&&"Special"===a.category||"Light Ball"===e.item&&"Pikachu"===e.name&&!a.isZ?(E.push(8192),r.attackerItem=e.item):(gen<7&&"Soul Dew"===e.item&&("Latios"===e.name||"Latias"===e.name)&&"Special"===a.category||"Choice Band"===e.item&&"Physical"===a.category&&!a.isZ||"Choice Specs"===e.item&&"Special"===a.category&&!a.isZ)&&(E.push(6144),r.attackerItem=e.item),D=Math.max(1,pokeRound(D*chainMods(E)/4096));var B,C="Physical"===a.category||a.dealsPhysicalDamage,L=C?DF:SD;r.defenseEVs=t.evs[L]+(NATURES[t.nature][0]===L?"+":NATURES[t.nature][1]===L?"-":"")+" "+toSmogonStat(L),0===t.boosts[L]||o&&t.boosts[L]>0||a.ignoresDefenseBoosts?B=t.rawStats[L]:"Unaware"===e.ability?(B=t.rawStats[L],r.attackerAbility=e.ability):(B=t.stats[L],r.defenseBoost=t.boosts[L]),"Sand"!==i.weather||"Rock"!==t.type1&&"Rock"!==t.type2||C||(B=pokeRound(3*B/2),r.weather=i.weather);var H=[];"Marvel Scale"===s&&"Healthy"!==t.status&&C?(H.push(6144),r.defenderAbility=s):"Flower Gift"!==s||-1===i.weather.indexOf("Sun")||C||(H.push(6144),r.defenderAbility=s,r.weather=i.weather),"Grassy"===i.terrain&&"Grass Pelt"===s&&C&&(H.push(6144),r.defenderAbility=s),(gen<7&&"Soul Dew"===t.item&&("Latios"===t.name||"Latias"===t.name)&&!C||"Assault Vest"===t.item&&!C||"Eviolite"===t.item)&&(H.push(6144),r.defenderItem=t.item),("Metal Powder"===t.item&&"Ditto"===t.name&&C||"Deep Sea Scale"===t.item&&"Clamperl"===t.name&&!C)&&(H.push(8192),r.defenderItem=t.item),"Fur Coat"===s&&C&&(H.push(8192),r.defenderAbility=s),B=Math.max(1,pokeRound(B*chainMods(H)/4096));var F=Math.floor(Math.floor(Math.floor(2*e.level/5+2)*v*D/B)/50+2);if("Singles"!==i.format&&a.isSpread&&(F=pokeRound(3072*F/4096)),-1!==i.weather.indexOf("Sun")&&"Fire"===a.type||-1!==i.weather.indexOf("Rain")&&"Water"===a.type)F=pokeRound(6144*F/4096),r.weather=i.weather;else if("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&"Fire"===a.type)F=pokeRound(2048*F/4096),r.weather=i.weather;else if("Harsh Sunshine"===i.weather&&"Water"===a.type||"Heavy Rain"===i.weather&&"Fire"===a.type)return{damage:[0],description:buildDescription(r)};(i.isGravity||"Flying"!==e.type1&&"Flying"!==e.type2&&"Air Balloon"!==e.item&&"Levitate"!==e.ability)&&("Electric"===i.terrain&&"Electric"===a.type?(F=pokeRound(6144*F/4096),r.terrain=i.terrain):"Grassy"===i.terrain&&"Grass"==a.type?(F=pokeRound(6144*F/4096),r.terrain=i.terrain):"Psychic"===i.terrain&&"Psychic"===a.type&&(F=pokeRound(6144*F/4096),r.terrain=i.terrain)),(i.isGravity||"Flying"!==t.type1&&"Flying"!==t.type2&&"Air Balloon"!==t.item&&"Levitate"!==t.ability)&&("Misty"===i.terrain&&"Dragon"===a.type?(F=pokeRound(2048*F/4096),r.terrain=i.terrain):"Grassy"!==i.terrain||"Bulldoze"!==a.name&&"Earthquake"!==a.name||(F=pokeRound(2048*F/4096),r.terrain=i.terrain)),o&&(F=Math.floor(F*(gen>=6?1.5:2)),r.isCritical=o);var _=4096;a.type===e.type1||a.type===e.type2?"Adaptability"===e.ability?(_=8192,r.attackerAbility=e.ability):_=6144:"Protean"===e.ability&&(_=6144,r.attackerAbility=e.ability);var O="Burned"===e.status&&"Physical"===a.category&&"Guts"!==e.ability&&!a.ignoresBurn;r.isBurned=O;var R=[];i.isReflect&&"Physical"===a.category&&!o?(R.push("Singles"!==i.format?gen>=6?2732:2703:2048),r.isReflect=!0):i.isLightScreen&&"Special"===a.category&&!o&&(R.push("Singles"!==i.format?gen>=6?2732:2703:2048),r.isLightScreen=!0),"Multiscale"!==s&&"Shadow Shield"!==s||t.curHP!==t.maxHP||i.isSR||i.spikes&&"Flying"!==t.type1&&"Flying"!==t.type2||(R.push(2048),r.defenderAbility=s),"Tinted Lens"===e.ability&&f<1&&(R.push(8192),r.attackerAbility=e.ability),"Water Bubble"===e.ability&&"Water"===a.type&&(R.push(8192),r.attackerAbility=e.ability),"Steelworker"===e.ability&&"Steel"===a.type&&(R.push(6144),r.attackerAbility=e.ability),i.isFriendGuard&&(R.push(3072),r.isFriendGuard=!0),i.isAuroraVeil&&!o&&(R.push("Singles"!==i.format?2732:2048),r.isAuroraVeil=!0),"Sniper"===e.ability&&o&&(R.push(6144),r.attackerAbility=e.ability),("Solid Rock"===s||"Filter"===s||"Prism Armor"===s)&&f>1&&(R.push(3072),r.defenderAbility=s),"Expert Belt"===e.item&&f>1&&!a.isZ?(R.push(4915),r.attackerItem=e.item):"Life Orb"!==e.item||a.isZ||(R.push(5324),r.attackerItem=e.item),getBerryResistType(t.item)===a.type&&(f>1||"Normal"===a.type)&&"Unnerve"!==e.ability&&(R.push(2048),r.defenderItem=t.item),i.isProtected&&a.isZ&&(R.push(1024),r.isProtected=!0);for(var G=chainMods(R),I=[],V=0;V<16;V++)if(I[V]=Math.floor(F*(85+V)/100),I[V]=pokeRound(I[V]*_/4096),I[V]=Math.floor(I[V]*f),O&&(I[V]=Math.floor(I[V]/2)),I[V]=Math.max(1,I[V]),I[V]=pokeRound(I[V]*G/4096),"Parental Bond"===e.ability&&1===a.hits&&("Singles"===i.format||!a.isSpread)){var W=gen<7?1.5:5/4;I[V]=Math.floor(I[V]*W),r.attackerAbility=e.ability}return{damage:I,description:buildDescription(r)}}function toSmogonStat(e){return e===AT?"Atk":e===DF?"Def":e===SA?"SpA":e===SD?"SpD":e===SP?"Spe":"wtf"}function chainMods(e){for(var t=4096,a=0;a<e.length;a++)4096!==e[a]&&(t=t*e[a]+2048>>12);return t}function getMoveEffectiveness(e,t,a,i){return!a||"Ghost"!==t||"Normal"!==e.type&&"Fighting"!==e.type?i&&"Flying"===t&&"Ground"===e.type?1:"Freeze-Dry"===e.name&&"Water"===t?2:"Flying Press"===e.name?typeChart.Fighting[t]*typeChart.Flying[t]:typeChart[e.type][t]:1}function getModifiedStat(e,t){return t>0?Math.floor(e*(2+t)/2):t<0?Math.floor(2*e/(2-t)):e}function getFinalSpeed(e,t){var a=getModifiedStat(e.rawStats[SP],e.boosts[SP]);return"Choice Scarf"===e.item?a=Math.floor(1.5*a):"Macho Brace"!==e.item&&"Iron Ball"!==e.item||(a=Math.floor(a/2)),("Chlorophyll"===e.ability&&-1!==t.indexOf("Sun")||"Sand Rush"===e.ability&&"Sand"===t||"Swift Swim"===e.ability&&-1!==t.indexOf("Rain")||"Slush Rush"===e.ability&&-1!==t.indexOf("Hail"))&&(a*=2),a}function checkAirLock(e,t){"Air Lock"!==e.ability&&"Cloud Nine"!==e.ability||t.clearWeather()}function checkForecast(e,t){"Forecast"===e.ability&&"Castform"===e.name&&(-1!==t.indexOf("Sun")?e.type1="Fire":-1!==t.indexOf("Rain")?e.type1="Water":e.type1="Hail"===t?"Ice":"Normal",e.type2="")}function checkKlutz(e){"Klutz"===e.ability&&(e.item="")}function checkIntimidate(e,t){"Intimidate"===e.ability&&("Contrary"===t.ability||"Defiant"===t.ability?t.boosts[AT]=Math.min(6,t.boosts[AT]+1):-1!==["Clear Body","White Smoke","Hyper Cutter","Full Metal Body"].indexOf(t.ability)||("Simple"===t.ability?t.boosts[AT]=Math.max(-6,t.boosts[AT]-2):t.boosts[AT]=Math.max(-6,t.boosts[AT]-1)))}function checkDownload(e,t){"Download"===e.ability&&(t.stats[SD]<=t.stats[DF]?e.boosts[SA]=Math.min(6,e.boosts[SA]+1):e.boosts[AT]=Math.min(6,e.boosts[AT]+1))}function checkInfiltrator(e,t){"Infiltrator"===e.ability&&(t.isReflect=!1,t.isLightScreen=!1,t.isAuroraVeil=!1)}function countBoosts(e){for(var t=0,a=0;a<STATS.length;a++)e[STATS[a]]>0&&(t+=e[STATS[a]]);return t}function isGroundedForCalc(e,t){return t.isGravity||"Flying"!==e.type1&&"Flying"!==e.type2&&"Levitate"!==e.ability&&"Air Balloon"!==e.item}function pokeRound(e){return e%1>.5?Math.ceil(e):Math.floor(e)}function CALCULATE_ALL_MOVES_DPP(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),checkDownload(t,e),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[SP]=getFinalSpeed(t,a.getWeather());for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_DPP(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_DPP(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_DPP(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[SP]=getFinalSpeed(t,a.getWeather());for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_DPP(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_DPP(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};if(i.isProtected&&!a.bypassesProtect)return r.isProtected=!0,{damage:[0],description:buildDescription(r)};var s=t.ability;"Mold Breaker"===e.ability&&(s="",r.attackerAbility=e.ability);var o=a.isCrit&&-1===["Battle Armor","Shell Armor"].indexOf(s);if("Weather Ball"===a.name)"Sun"===i.weather?(a.type="Fire",a.bp*=2):"Rain"===i.weather?(a.type="Water",a.bp*=2):"Sand"===i.weather?(a.type="Rock",a.bp*=2):"Hail"===i.weather?(a.type="Ice",a.bp*=2):a.type="Normal",r.weather=i.weather,r.moveType=a.type,r.moveBP=f;else if("Judgment"===a.name&&-1!==e.item.indexOf("Plate"))a.type=getItemBoostType(e.item);else if("Natural Gift"===a.name&&-1!==e.item.indexOf("Berry")){var n=getNaturalGift(e.item);a.type=n.t,a.bp=n.p,r.attackerItem=e.item,r.moveBP=a.bp,r.moveType=a.type}"Normalize"===e.ability&&(a.type="Normal",r.attackerAbility=e.ability);var l=getMoveEffectiveness(a,t.type1,"Scrappy"===e.ability||i.isForesight,i.isGravity),c=t.type2?getMoveEffectiveness(a,t.type2,"Scrappy"===e.ability||i.isForesight,i.isGravity):1,d=l*c;if(0===d)return{damage:[0],description:buildDescription(r)};if("Wonder Guard"===s&&d<=1||"Fire"===a.type&&-1!==s.indexOf("Flash Fire")||"Water"===a.type&&-1!==["Dry Skin","Water Absorb"].indexOf(s)||"Electric"===a.type&&-1!==["Motor Drive","Volt Absorb"].indexOf(s)||"Ground"===a.type&&!i.isGravity&&"Levitate"===s||a.isSound&&"Soundproof"===s)return r.defenderAbility=s,{damage:[0],description:buildDescription(r)};if(r.HPEVs=t.HPEVs+" HP","Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[e.level],description:buildDescription(r)};a.hits>1&&(r.hits=a.hits);var h=e.stats[SP]>t.stats[SP]?"FIRST":"LAST";switch(a.name){case"Brine":t.curHP<=t.maxHP/2&&(a.bp*=2,r.moveBP=a.bp);break;case"Eruption":case"Water Spout":a.bp=Math.max(1,Math.floor(a.bp*e.curHP/e.maxHP)),r.moveBP=a.bp;break;case"Facade":-1!==["Paralyzed","Poisoned","Badly Poisoned","Burned"].indexOf(e.status)&&(a.bp*=2,r.moveBP=a.bp);break;case"Flail":case"Reversal":var p=Math.floor(48*e.curHP/e.maxHP);a.bp=p<=1?200:p<=4?150:p<=9?100:p<=16?80:p<=32?40:20,r.moveBP=a.bp;break;case"Fling":a.bp=getFlingPower(e.item),r.moveBP=a.bp,r.attackerItem=e.item;break;case"Grass Knot":case"Low Kick":var m=t.weight;a.bp=m>=200?120:m>=100?100:m>=50?80:m>=25?60:m>=10?40:20,r.moveBP=a.bp;break;case"Gyro Ball":a.bp=Math.min(150,Math.floor(25*t.stats[SP]/e.stats[SP])),r.moveBP=a.bp;break;case"Payback":"FIRST"!==h&&(a.bp*=2,r.moveBP=a.bp);break;case"Punishment":var u=countBoosts(t.boosts);u>0&&(a.bp=Math.min(200,a.bp+20*u),r.moveBP=a.bp);break;case"Wake-Up Slap":"Asleep"===t.status&&(a.bp*=2,r.moveBP=a.bp);break;case"Wring Out":a.bp=Math.floor(120*t.curHP/t.maxHP)+1,r.moveBP=a.bp}var f=a.bp;i.isHelpingHand&&(f=Math.floor(1.5*f),r.isHelpingHand=!0);var y="Physical"===a.category;"Muscle Band"===e.item&&y||"Wise Glasses"===e.item&&!y?(f=Math.floor(1.1*f),r.attackerItem=e.item):(getItemBoostType(e.item)===a.type||("Adamant Orb"===e.item&&"Dialga"===e.name||"Lustrous Orb"===e.item&&"Palkia"===e.name||"Griseous Orb"===e.item&&"Giratina-Origin"===e.name)&&(a.type===e.type1||a.type===e.type2))&&(f=Math.floor(1.2*f),r.attackerItem=e.item),"Reckless"===e.ability&&a.hasRecoil||"Iron Fist"===e.ability&&a.isPunch?(f=Math.floor(1.2*f),r.attackerAbility=e.ability):(e.curHP<=e.maxHP/3&&("Overgrow"===e.ability&&"Grass"===a.type||"Blaze"===e.ability&&"Fire"===a.type||"Torrent"===e.ability&&"Water"===a.type||"Swarm"===e.ability&&"Bug"===a.type)||"Technician"===e.ability&&a.bp<=60)&&(f=Math.floor(1.5*f),r.attackerAbility=e.ability),"Thick Fat"===s&&("Fire"===a.type||"Ice"===a.type)||"Heatproof"===s&&"Fire"===a.type?(f=Math.floor(.5*f),r.defenderAbility=s):"Dry Skin"===s&&"Fire"===a.type&&(f=Math.floor(1.25*f),r.defenderAbility=s);var S=y?AT:SA;r.attackEVs=e.evs[S]+(NATURES[e.nature][0]===S?"+":NATURES[e.nature][1]===S?"-":"")+" "+toSmogonStat(S);var v,b=e.boosts[S],g=e.rawStats[S];0===b||o&&b<0?v=g:"Unaware"===s?(v=g,r.defenderAbility=s):"Simple"===e.ability?(v=getSimpleModifiedStat(g,b),r.attackerAbility=e.ability,r.attackBoost=b):(v=getModifiedStat(g,b),r.attackBoost=b),!y||"Pure Power"!==e.ability&&"Huge Power"!==e.ability?"Sun"===i.weather&&(y?"Flower Gift"===e.ability:"Solar Power"===e.ability)?(v=Math.floor(1.5*v),r.attackerAbility=e.ability,r.weather=i.weather):(y&&("Hustle"===e.ability||"Guts"===e.ability&&"Healthy"!==e.status)||!y&&("Plus"===e.ability||"Minus"===e.ability))&&(v=Math.floor(1.5*v),r.attackerAbility=e.ability):(v*=2,r.attackerAbility=e.ability),(y?"Choice Band"!==e.item:"Choice Specs"!==e.item)&&("Soul Dew"!==e.item||"Latios"!==e.name&&"Latias"!==e.name||y)?("Light Ball"===e.item&&"Pikachu"===e.name||"Thick Club"===e.item&&("Cubone"===e.name||"Marowak"===e.name)&&y||"Deep Sea Tooth"===e.item&&"Clamperl"===e.name&&!y)&&(v*=2,r.attackerItem=e.item):(v=Math.floor(1.5*v),r.attackerItem=e.item);var k=y?DF:SD;r.defenseEVs=t.evs[k]+(NATURES[t.nature][0]===k?"+":NATURES[t.nature][1]===k?"-":"")+" "+toSmogonStat(k);var A,M=t.boosts[k],P=t.rawStats[k];0===M||o&&M>0?A=P:"Unaware"===e.ability?(A=P,r.attackerAbility=e.ability):"Simple"===s?(A=getSimpleModifiedStat(P,M),r.defenderAbility=s,r.defenseBoost=M):(A=getModifiedStat(P,M),r.defenseBoost=M),"Marvel Scale"===s&&"Healthy"!==t.status&&y?(A=Math.floor(1.5*A),r.defenderAbility=s):"Flower Gift"!==s||"Sun"!==i.weather||y||(A=Math.floor(1.5*A),r.defenderAbility=s,r.weather=i.weather),"Soul Dew"!==t.item||"Latios"!==t.name&&"Latias"!==t.name||y?("Deep Sea Scale"===t.item&&"Clamperl"===t.name&&!y||"Metal Powder"===t.item&&"Ditto"===t.name&&y)&&(A*=2,r.defenderItem=t.item):(A=Math.floor(1.5*A),r.defenderItem=t.item),"Sand"!==i.weather||"Rock"!==t.type1&&"Rock"!==t.type2||y||(A=Math.floor(1.5*A),r.weather=i.weather),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(A=Math.floor(.5*A)),A<1&&(A=1);var T=Math.floor(Math.floor(Math.floor(2*e.level/5+2)*f*v/50)/A);if("Burned"===e.status&&y&&"Guts"!==e.ability&&(T=Math.floor(.5*T),r.isBurned=!0),!o){var x="Singles"!==i.format?2/3:.5;y&&i.isReflect?(T=Math.floor(T*x),r.isReflect=!0):!y&&i.isLightScreen&&(T=Math.floor(T*x),r.isLightScreen=!0)}"Singles"!==i.format&&a.isSpread&&(T=Math.floor(3*T/4)),"Sun"===i.weather&&"Fire"===a.type||"Rain"===i.weather&&"Water"===a.type?(T=Math.floor(1.5*T),r.weather=i.weather):("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&"Fire"===a.type||-1!==["Rain","Sand","Hail"].indexOf(i.weather)&&"Solar Beam"===a.name)&&(T=Math.floor(.5*T),r.weather=i.weather),"Flash Fire (activated)"===e.ability&&"Fire"===a.type&&(T=Math.floor(1.5*T),r.attackerAbility="Flash Fire"),T+=2,o&&("Sniper"===e.ability?(T*=3,r.attackerAbility=e.ability):T*=2,r.isCritical=o),"Life Orb"===e.item&&(T=Math.floor(1.3*T),r.attackerItem=e.item);var D=1;a.type!==e.type1&&a.type!==e.type2||("Adaptability"===e.ability?(D=2,r.attackerAbility=e.ability):D=1.5);var w=1;("Filter"===s||"Solid Rock"===s)&&d>1&&(w=.75,r.defenderAbility=s);var $=1;"Expert Belt"===e.item&&d>1&&($=1.2,r.attackerItem=e.item);var E=1;"Tinted Lens"===e.ability&&d<1&&(E=2,r.attackerAbility=e.ability);var B=1;getBerryResistType(t.item)===a.type&&(d>1||"Normal"===a.type)&&(B=.5,r.defenderItem=t.item);for(var C=[],L=0;L<16;L++)C[L]=Math.floor(T*(85+L)/100),C[L]=Math.floor(C[L]*D),C[L]=Math.floor(C[L]*l),C[L]=Math.floor(C[L]*c),C[L]=Math.floor(C[L]*w),C[L]=Math.floor(C[L]*$),C[L]=Math.floor(C[L]*E),C[L]=Math.floor(C[L]*B),C[L]=Math.max(1,C[L]);return{damage:C,description:buildDescription(r)}}function getSimpleModifiedStat(e,t){var a=Math.min(6,Math.max(-6,2*t));return a>0?Math.floor(e*(2+a)/2):a<0?Math.floor(2*e/(2-a)):e}function CALCULATE_ALL_MOVES_ADV(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e);for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_ADV(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_ADV(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_ADV(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e);for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_ADV(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_ADV(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};if(i.isProtected)return r.isProtected=!0,{damage:[0],description:buildDescription(r)};"Weather Ball"===a.name&&(a.type="Sun"===i.weather?"Fire":"Rain"===i.weather?"Water":"Sand"===i.weather?"Rock":"Hail"===i.weather?"Ice":"Normal",r.weather=i.weather,r.moveType=a.type,r.moveBP=a.bp);var s=getMoveEffectiveness(a,t.type1,i.isForesight)*(t.type2?getMoveEffectiveness(a,t.type2,i.isForesight):1);if(0===s)return{damage:[0],description:buildDescription(r)};if(-1!==t.ability.indexOf("Flash Fire")&&"Fire"===a.type||"Levitate"===t.ability&&"Ground"===a.type||"Volt Absorb"===t.ability&&"Electric"===a.type||"Water Absorb"===t.ability&&"Water"===a.type||"Wonder Guard"===t.ability&&s<=1||"Soundproof"===t.ability&&a.isSound)return r.defenderAbility=t.ability,{damage:[0],description:buildDescription(r)};r.HPEVs=t.HPEVs+" HP";var o=e.level;if("Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[o],description:buildDescription(r)};a.hits>1&&(r.hits=a.hits);var n;switch(a.name){case"Flail":case"Reversal":var l=Math.floor(48*e.curHP/e.maxHP);n=l<=1?200:l<=4?150:l<=9?100:l<=16?80:l<=32?40:20,r.moveBP=n;break;case"Eruption":case"Water Spout":n=Math.max(1,Math.floor(150*e.curHP/e.maxHP)),r.moveBP=n;break;case"Low Kick":var c=t.weight;n=c>=200?120:c>=100?100:c>=50?80:c>=25?60:c>=10?40:20,r.moveBP=n;break;default:n=a.bp}var d="Physical"===typeChart[a.type].category,h=d?AT:SA;r.attackEVs=e.evs[h]+(NATURES[e.nature][0]===h?"+":NATURES[e.nature][1]===h?"-":"")+" "+toSmogonStat(h);var p=d?DF:SD;r.defenseEVs=t.evs[p]+(NATURES[t.nature][0]===p?"+":NATURES[t.nature][1]===p?"-":"")+" "+toSmogonStat(p);var m=e.rawStats[h],u=t.rawStats[p];!d||"Huge Power"!==e.ability&&"Pure Power"!==e.ability||(m*=2,r.attackerAbility=e.ability),"Sea Incense"!==e.item&&getItemBoostType(e.item)===a.type?(m=Math.floor(1.1*m),r.attackerItem=e.item):"Sea Incense"===e.item&&"Water"===a.type?(m=Math.floor(1.05*m),r.attackerItem=e.item):d&&"Choice Band"===e.item||!d&&"Soul Dew"===e.item&&("Latios"===e.name||"Latias"===e.name)?(m=Math.floor(1.5*m),r.attackerItem=e.item):(!d&&"Deep Sea Tooth"===e.item&&"Clamperl"===e.name||!d&&"Light Ball"===e.item&&"Pikachu"===e.name||d&&"Thick Club"===e.item&&("Cubone"===e.name||"Marowak"===e.name))&&(m*=2,r.attackerItem=e.item),d||"Soul Dew"!==t.item||"Latios"!==t.name&&"Latias"!==t.name?(!d&&"Deep Sea Scale"===t.item&&"Clamperl"===t.name||d&&"Metal Powder"===t.item&&"Ditto"===t.name)&&(u*=2,r.defenderItem=t.item):(u=Math.floor(1.5*u),r.defenderItem=t.item),"Thick Fat"!==t.ability||"Fire"!==a.type&&"Ice"!==a.type?d&&"Marvel Scale"===t.ability&&"Healthy"!==t.status&&(u=Math.floor(1.5*u),r.defenderAbility=t.ability):(m=Math.floor(m/2),r.defenderAbility=t.ability),d&&("Hustle"===e.ability||"Guts"===e.ability&&"Healthy"!==e.status)||!d&&("Plus"===e.ability||"Minus"===e.ability)?(m=Math.floor(1.5*m),r.attackerAbility=e.ability):e.curHP<=e.maxHP/3&&("Overgrow"===e.ability&&"Grass"===a.type||"Blaze"===e.ability&&"Fire"===a.type||"Torrent"===e.ability&&"Water"===a.type||"Swarm"===e.ability&&"Bug"===a.type)&&(n=Math.floor(1.5*n),r.attackerAbility=e.ability),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(u=Math.floor(u/2));var f=a.isCrit&&-1===["Battle Armor","Shell Armor"].indexOf(t.ability),y=e.boosts[h],S=t.boosts[p];(y>0||!f&&y<0)&&(m=getModifiedStat(m,y),r.attackBoost=y),(S<0||!f&&S>0)&&(u=getModifiedStat(u,S),r.defenseBoost=S);var v=Math.floor(Math.floor(Math.floor(2*o/5+2)*m*n/u)/50);if("Burned"===e.status&&d&&"Guts"!==e.ability&&(v=Math.floor(v/2),r.isBurned=!0),!f){var b="Singles"!==i.format?2/3:.5;d&&i.isReflect?(v=Math.floor(v*b),r.isReflect=!0):!d&&i.isLightScreen&&(v=Math.floor(v*b),r.isLightScreen=!0)}"Singles"!==i.format&&a.isSpread&&(v=Math.floor(3*v/4)),"Sun"===i.weather&&"Fire"===a.type||"Rain"===i.weather&&"Water"===a.type?(v=Math.floor(1.5*v),r.weather=i.weather):("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&"Fire"===a.type||"Solar Beam"===a.name&&-1!==["Rain","Sand","Hail"].indexOf(i.weather))&&(v=Math.floor(v/2),r.weather=i.weather),"Flash Fire (activated)"===e.ability&&"Fire"===a.type&&(v=Math.floor(1.5*v),r.attackerAbility="Flash Fire"),v=Math.max(1,v)+2,f&&(v*=2,r.isCritical=!0),"Weather Ball"===a.name&&""!==i.weather&&(v*=2,r.moveBP=2*a.bp),i.isHelpingHand&&(v=Math.floor(1.5*v),r.isHelpingHand=!0),a.type!==e.type1&&a.type!==e.type2||(v=Math.floor(1.5*v)),v=Math.floor(v*s);for(var g=[],k=85;k<=100;k++)g[k-85]=Math.max(1,Math.floor(v*k/100));return{damage:g,description:buildDescription(r)}}function CALCULATE_ALL_MOVES_GSC(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[DF],e.boosts[DF]))),e.stats[SA]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SA],e.boosts[SA]))),e.stats[SD]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SD],e.boosts[SD]))),t.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[AT],t.boosts[AT]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SA]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SA],t.boosts[SA]))),t.stats[SD]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SD],t.boosts[SD])));for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_GSC(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_GSC(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_GSC(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[SA]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SA],e.boosts[SA]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SD]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SD],t.boosts[SD])));for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_GSC(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_GSC(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};if(i.isProtected)return r.isProtected=!0,{damage:[0],description:buildDescription(r)};var s=getMoveEffectiveness(a,t.type1,i.isForesight)*(t.type2?getMoveEffectiveness(a,t.type2,i.isForesight):1);if(0===s)return{damage:[0],description:buildDescription(r)};var o=e.level;if("Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[o],description:buildDescription(r)};if(a.hits>1&&(r.hits=a.hits),"Flail"===a.name||"Reversal"===a.name){a.isCrit=!1;var n=Math.floor(48*e.curHP/e.maxHP);a.bp=n<=1?200:n<=4?150:n<=9?100:n<=16?80:n<=32?40:20,r.moveBP=a.bp}var l="Physical"===typeChart[a.type].category,c=l?AT:SA,d=l?DF:SD,h=e.stats[c],p=t.stats[d],m=a.isCrit&&e.boosts[c]<=t.boosts[d];m?(h=e.rawStats[c],p=t.rawStats[d]):(0!==e.boosts[c]&&(r.attackBoost=e.boosts[c]),0!==t.boosts[d]&&(r.defenseBoost=t.boosts[d]),l&&"Burned"===e.status&&(h=Math.floor(h/2),r.isBurned=!0)),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(p=Math.floor(p/2)),m||(l&&i.isReflect?(p*=2,r.isReflect=!0):!l&&i.isLightScreen&&(p*=2,r.isLightScreen=!0)),("Pikachu"===e.name&&"Light Ball"===e.item&&!l||("Cubone"===e.name||"Marowak"===e.name)&&"Thick Club"===e.item&&l)&&(h*=2,r.attackerItem=e.item),(h>255||p>255)&&(h=Math.floor(h/4)%256,p=Math.floor(p/4)%256),"Ditto"===t.name&&"Metal Powder"===t.item&&(p=Math.floor(1.5*p),r.defenderItem=t.item);var u=Math.floor(Math.floor(Math.floor(2*o/5+2)*Math.max(1,h)*a.bp/Math.max(1,p))/50);if(a.isCrit&&(u*=2,r.isCritical=!0),getItemBoostType(e.item)===a.type&&(u=Math.floor(1.1*u),r.attackerItem=e.item),u=Math.min(997,u)+2,"Sun"===i.weather&&"Fire"===a.type||"Rain"===i.weather&&"Water"===a.type?(u=Math.floor(1.5*u),r.weather=i.weather):("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&("Fire"===a.type||"Solar Beam"===a.name))&&(u=Math.floor(u/2),r.weather=i.weather),a.type!==e.type1&&a.type!==e.type2||(u=Math.floor(1.5*u)),u=Math.floor(u*s),"Flail"===a.name||"Reversal"===a.name)return{damage:[u],description:buildDescription(r)};for(var f=[],y=217;y<=255;y++)f[y-217]=Math.floor(u*y/255);return{damage:f,description:buildDescription(r)}}function CALCULATE_ALL_MOVES_RBY(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[DF],e.boosts[DF]))),e.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SL],e.boosts[SL]))),t.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[AT],t.boosts[AT]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SL],t.boosts[SL])));for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_RBY(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_RBY(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_RBY(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SL],e.boosts[SL]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SL],t.boosts[SL])));for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_RBY(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_RBY(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};var s=e.level;if("Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[s],description:buildDescription(r)};var o=typeChart[a.type][t.type1]*(t.type2?typeChart[a.type][t.type2]:1);if(0===o)return{damage:[0],description:buildDescription(r)};a.hits>1&&(r.hits=a.hits);var n="Physical"===typeChart[a.type].category,l=n?AT:SL,c=n?DF:SL,d=e.stats[l],h=t.stats[c];a.isCrit?(s*=2,d=e.rawStats[l],h=t.rawStats[c],r.isCritical=!0):(0!==e.boosts[l]&&(r.attackBoost=e.boosts[l]),0!==t.boosts[c]&&(r.defenseBoost=t.boosts[c]),n&&"Burned"===e.status&&(d=Math.floor(d/2),r.isBurned=!0)),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(h=Math.floor(h/2)),a.isCrit||(n&&i.isReflect?(h*=2,r.isReflect=!0):!n&&i.isLightScreen&&(h*=2,r.isLightScreen=!0)),(d>255||h>255)&&(d=Math.floor(d/4)%256,h=Math.floor(h/4)%256);var p=Math.min(997,Math.floor(Math.floor(Math.floor(2*s/5+2)*Math.max(1,d)*a.bp/Math.max(1,h))/50))+2;a.type!==e.type1&&a.type!==e.type2||(p=Math.floor(1.5*p)),p=Math.floor(p*o);for(var m=[],u=217;u<=255;u++)m[u-217]=Math.floor(p*u/255);return{damage:m,description:buildDescription(r)}}function buildDescription(e){var t="";return e.attackBoost&&(e.attackBoost>0&&(t+="+"),t+=e.attackBoost+" "),t=appendIfSet(t,e.attackEVs),t=appendIfSet(t,e.attackerItem),t=appendIfSet(t,e.attackerAbility),e.isBurned&&(t+="burned "),t+=e.attackerName+" ",e.isHelpingHand&&(t+="Helping Hand "),t+=e.moveName+" ",e.moveBP&&e.moveType?t+="("+e.moveBP+" BP "+e.moveType+") ":e.moveBP?t+="("+e.moveBP+" BP) ":e.moveType&&(t+="("+e.moveType+") "),e.hits&&(t+="("+e.hits+" hits) "),t+="vs. ",e.defenseBoost&&(e.defenseBoost>0&&(t+="+"),t+=e.defenseBoost+" "),t=appendIfSet(t,e.HPEVs),e.defenseEVs&&(t+=" / "+e.defenseEVs+" "),t=appendIfSet(t,e.defenderItem),t=appendIfSet(t,e.defenderAbility),e.isProtected&&(t+="protected "),t+=e.defenderName,e.weather&&e.terrain||(e.weather?t+=" in "+e.weather:e.terrain&&(t+=" in "+e.terrain+" Terrain")),e.isReflect?t+=" through Reflect":e.isLightScreen&&(t+=" through Light Screen"),e.isFriendGuard&&(t+=" with an ally's Friend Guard"),e.isAuroraVeil&&(t+=" with an ally's Aurora Veil"),e.isCritical&&(t+=" on a critical hit"),t}function appendIfSet(e,t){return t?e+t+" ":e}function getKOChanceText(e,t,a,i,r,s,o){if(isNaN(e[0]))return"something broke; please tell Austin or Marty";if(0===e[e.length-1])return"aim for the horn next time";if(e[0]>=a.maxHP)return"guaranteed OHKO";var n=0,l=[];if(i.isSR&&-1===["Magic Guard","Mountaineer"].indexOf(a.ability)){var c=typeChart.Rock[a.type1]*(a.type2?typeChart.Rock[a.type2]:1);n+=Math.floor(c*a.maxHP/8),l.push("Stealth Rock")}-1===[a.type1,a.type2].indexOf("Flying")&&-1===["Magic Guard","Levitate"].indexOf(a.ability)&&"Air Balloon"!==a.item&&(1===i.spikes?(n+=Math.floor(a.maxHP/8),2===gen?l.push("Spikes"):l.push("1 layer of Spikes")):2===i.spikes?(n+=Math.floor(a.maxHP/6),l.push("2 layers of Spikes")):3===i.spikes&&(n+=Math.floor(a.maxHP/4),l.push("3 layers of Spikes"))),isNaN(n)&&(n=0);var d=0,h=[];"Sun"===i.weather||"Harsh Sunshine"===i.weather?"Dry Skin"!==a.ability&&"Solar Power"!==a.ability||(d-=Math.floor(a.maxHP/8),h.push(a.ability+" damage")):"Rain"===i.weather||"Heavy Rain"===i.weather?"Dry Skin"===a.ability?(d+=Math.floor(a.maxHP/8),h.push("Dry Skin recovery")):"Rain Dish"===a.ability&&(d+=Math.floor(a.maxHP/16),h.push("Rain Dish recovery")):"Sand"===i.weather?-1===["Rock","Ground","Steel"].indexOf(a.type1)&&-1===["Rock","Ground","Steel"].indexOf(a.type2)&&-1===["Magic Guard","Overcoat","Sand Force","Sand Rush","Sand Veil"].indexOf(a.ability)&&"Safety Goggles"!==a.item&&(d-=Math.floor(a.maxHP/16),h.push("sandstorm damage")):"Hail"===i.weather&&("Ice Body"===a.ability?(d+=Math.floor(a.maxHP/16),h.push("Ice Body recovery")):"Ice"!==a.type1&&"Ice"!==a.type2&&-1===["Magic Guard","Overcoat","Snow Cloak"].indexOf(a.ability)&&"Safety Goggles"!==a.item&&(d-=Math.floor(a.maxHP/16),h.push("hail damage"))),"Leftovers"===a.item?(d+=Math.floor(a.maxHP/16),h.push("Leftovers recovery")):"Black Sludge"===a.item?"Poison"===a.type1||"Poison"===a.type2?(d+=Math.floor(a.maxHP/16),h.push("Black Sludge recovery")):"Magic Guard"!==a.ability&&"Klutz"!==a.ability&&(d-=Math.floor(a.maxHP/8),h.push("Black Sludge damage")):"Sticky Barb"===a.item&&(d-=Math.floor(a.maxHP/8),h.push("Sticky Barb damage")),i.isDefenderSeeded&&"Magic Guard"!==a.ability&&(d-=gen>=2?Math.floor(a.maxHP/8):Math.floor(a.maxHP/16),h.push("Leech Seed damage")),i.isAttackerSeeded&&("Magic Guard"===t.ability||("Liquid Ooze"===t.ability?(d-=gen>=2?Math.floor(t.maxHP/8):Math.floor(t.maxHP/16),h.push("Liquid Ooze damage")):(d+=gen>=2?Math.floor(t.maxHP/8):Math.floor(t.maxHP/16),h.push("Leech Seed recovery")))),"Grassy"===i.terrain&&(i.isGravity||"Flying"!==a.type1&&"Flying"!==a.type2&&"Air Balloon"!==a.item&&"Levitate"!==a.ability)&&(d+=Math.floor(a.maxHP/16),h.push("Grassy Terrain recovery"));var p=0;"Poisoned"===a.status?"Poison Heal"===a.ability?(d+=Math.floor(a.maxHP/8),h.push("Poison Heal")):"Magic Guard"!==a.ability&&(d-=Math.floor(a.maxHP/8),h.push("poison damage")):"Badly Poisoned"===a.status?"Poison Heal"===a.ability?(d+=Math.floor(a.maxHP/8),h.push("Poison Heal")):"Magic Guard"!==a.ability&&(h.push("toxic damage"),p=a.toxicCounter):"Burned"===a.status?"Heatproof"===a.ability?(d-=gen>6?Math.floor(a.maxHP/32):Math.floor(a.maxHP/16),h.push("reduced burn damage")):"Magic Guard"!==a.ability&&(d-=gen>6?Math.floor(a.maxHP/16):Math.floor(a.maxHP/8),h.push("burn damage")):"Asleep"!==a.status&&"Comatose"!==a.ability||!o||"Magic Guard"===a.ability||(d-=Math.floor(a.maxHP/8),h.push("Bad Dreams")),"Bind"!==r.name&&"Clamp"!==r.name&&"Fire Spin"!==r.name&&"Infestation"!==r.name&&"Magma Storm"!==r.name&&"Sand Tomb"!==r.name&&"Whirlpool"!==r.name&&"Wrap"!==r.name||("Binding Band"===t.item?(d-=gen>5?Math.floor(a.maxHP/6):Math.floor(a.maxHP/8),h.push("trapping damage")):(d-=gen>5?Math.floor(a.maxHP/8):Math.floor(a.maxHP/16),h.push("trapping damage"))),"Fire Pledge (Grass Pledge Boosted)"!==r.name&&"Grass Pledge (Fire Pledge Boosted)"!==r.name||"Fire"===a.type1||"Fire"===a.type2||(d-=Math.floor(a.maxHP/8),h.push("Sea of Fire damage"));var m="";s>1&&(m="approx. ",e=squashMultihit(e,s));var u=getKOChance(e,a.maxHP-n,0,1,a.maxHP,p),f=l.length>0?" after "+serializeText(l):"";if(1===u)return"guaranteed OHKO"+f;if(u>0)return m+Math.round(1e3*u)/10+"% chance to OHKO"+f;f=l.length>0||h.length>0?" after "+serializeText(l.concat(h)):"";var y;for(y=2;y<=4;y++){if(1===(u=getKOChance(e,a.maxHP-n,d,y,a.maxHP,p)))return"guaranteed "+y+"HKO"+f;if(u>0)return m+Math.round(1e3*u)/10+"% chance to "+y+"HKO"+f}for(y=5;y<=9;y++){if(predictTotal(e[0],d,y,p,a.maxHP)>=a.maxHP-n)return"guaranteed "+y+"HKO"+f;if(predictTotal(e[e.length-1],d,y,p,a.maxHP)>=a.maxHP-n)return"possible "+y+"HKO"+f}return"possibly the worst move ever"}function getKOChance(e,t,a,i,r,s){var o,n=e.length,l=e[0],c=e[n-1];if(1===i){if(c<t)return 0;for(o=0;o<n;o++)if(e[o]>=t)return(n-o)/n}if(predictTotal(c,a,i,s,r)<t)return 0;if(predictTotal(l,a,i,s,r)>=t)return 1;var d=0;s>0&&(d=Math.floor(s*r/16),s++);var h=0;for(o=0;o<n;o++){var p=getKOChance(e,t-e[o]+a-d,a,i-1,r,s);if(1===p){h+=n-o;break}h+=p}return h/n}function predictTotal(e,t,a,i,r){var s=0;if(i>0)for(var o=0;o<a-1;o++)s+=Math.floor((i+o)*r/16);return e*a-t*(a-1)+s}function squashMultihit(e,t){if(1===e.length)return[e[0]*t];if(1===gen){for(var a=[],i=0;i<e.length;i++)a[i]=e[i]*t;return a}if(16===e.length)switch(t){case 2:return[2*e[0],e[2]+e[3],e[4]+e[4],e[4]+e[5],e[5]+e[6],e[6]+e[6],e[6]+e[7],e[7]+e[7],e[8]+e[8],e[8]+e[9],e[9]+e[9],e[9]+e[10],e[10]+e[11],e[11]+e[11],e[12]+e[13],2*e[15]];case 3:return[3*e[0],e[3]+e[3]+e[4],e[4]+e[4]+e[5],e[5]+e[5]+e[6],e[5]+e[6]+e[6],e[6]+e[6]+e[7],e[6]+e[7]+e[7],e[7]+e[7]+e[8],e[7]+e[8]+e[8],e[8]+e[8]+e[9],e[8]+e[9]+e[9],e[9]+e[9]+e[10],e[9]+e[10]+e[10],e[10]+e[11]+e[11],e[11]+e[12]+e[12],3*e[15]];case 4:return[4*e[0],4*e[4],e[4]+e[5]+e[5]+e[5],e[5]+e[5]+e[6]+e[6],4*e[6],e[6]+e[6]+e[7]+e[7],4*e[7],e[7]+e[7]+e[7]+e[8],e[7]+e[8]+e[8]+e[8],4*e[8],e[8]+e[8]+e[9]+e[9],4*e[9],e[9]+e[9]+e[10]+e[10],e[10]+e[10]+e[10]+e[11],4*e[11],4*e[15]];case 5:return[5*e[0],e[4]+e[4]+e[4]+e[5]+e[5],e[5]+e[5]+e[5]+e[5]+e[6],e[5]+e[6]+e[6]+e[6]+e[6],e[6]+e[6]+e[6]+e[6]+e[7],e[6]+e[6]+e[7]+e[7]+e[7],5*e[7],e[7]+e[7]+e[7]+e[8]+e[8],e[7]+e[7]+e[8]+e[8]+e[8],5*e[8],e[8]+e[8]+e[8]+e[9]+e[9],e[8]+e[9]+e[9]+e[9]+e[9],e[9]+e[9]+e[9]+e[9]+e[10],e[9]+e[10]+e[10]+e[10]+e[10],e[10]+e[10]+e[11]+e[11]+e[11],5*e[15]];default:return console.log("Unexpected # of hits: "+t),e}else{if(39!==e.length)return console.log("Unexpected # of possible damage values: "+e.length),e;switch(t){case 2:return[2*e[0],2*e[7],2*e[10],2*e[12],2*e[14],e[15]+e[16],2*e[17],e[18]+e[19],e[19]+e[20],2*e[21],e[22]+e[23],2*e[24],2*e[26],2*e[28],2*e[31],2*e[38]];case 3:return[3*e[0],3*e[9],3*e[12],3*e[13],3*e[15],3*e[16],3*e[17],3*e[18],3*e[20],3*e[21],3*e[22],3*e[23],3*e[25],3*e[26],3*e[29],3*e[38]];case 4:return[4*e[0],2*e[10]+2*e[11],4*e[13],4*e[14],2*e[15]+2*e[16],2*e[16]+2*e[17],2*e[17]+2*e[18],2*e[18]+2*e[19],2*e[19]+2*e[20],2*e[20]+2*e[21],2*e[21]+2*e[22],2*e[22]+2*e[23],4*e[24],4*e[25],2*e[27]+2*e[28],4*e[38]];case 5:return[5*e[0],5*e[11],5*e[13],5*e[15],5*e[16],5*e[17],5*e[18],5*e[19],5*e[19],5*e[20],5*e[21],5*e[22],5*e[23],5*e[25],5*e[27],5*e[38]];default:return console.log("Unexpected # of hits: "+t),e}}}function serializeText(e){if(0===e.length)return"";if(1===e.length)return e[0];if(2===e.length)return e[0]+" and "+e[1];for(var t="",a=0;a<e.length-1;a++)t+=e[a]+", ";return t+"and "+e[e.length-1]}function placeBsBtn(){$("#import-1_wrapper").append("<button class='bs-btn bs-btn-default'>Import</button>"),$(".bs-btn").click(function(){addSets(document.getElementsByClassName("import-team-text")[0].value)})}function getAbility(e){return ability=e[1]?e[1].trim():"",-1!=ABILITIES_SM.indexOf(ability)?ability:void 0}function statConverter(e){switch(e){case"hp":return"hp";case"atk":return"at";case"def":return"df";case"spa":return"sa";case"spd":return"sd";case"spe":return"sp"}}function getStats(e,t,a){e.nature="Serious";var i,r,s;e.level=100;for(var o=a;o<a+7;o++){var n=t[o]?t[o].split(/[/:]/):"",l={},c={};switch(n[0]){case"Level":e.level=parseInt(n[1].trim());break;case"EVs":for(j=1;j<n.length;j++)(i=n[j].trim().split(" "))[1]=statConverter(i[1].toLowerCase()),l[i[1]]=parseInt(i[0]);e.evs=l;break;case"IVs":for(j=1;j<n.length;j++)(r=n[j].trim().split(" "))[1]=statConverter(r[1].toLowerCase()),c[r[1]]=parseInt(r[0]);e.ivs=c}"Nature"==(s=t[o]?t[o].trim().split(" "):"")[1]&&(e.nature=s[0])}return e}function getItem(e,t){for(;t<e.length;t++){var a=e[t].trim();if(-1!=ITEMS_SM.indexOf(a))return a}}function getMoves(e,t,a){for(var i=!1,r=[],s=a;s<a+12;s++)if(t[s])if("-"==t[s][0]){i=!0;var o=t[s].substr(2,t[s].length-2).replace("[","").replace("]","").replace("  ","");r.push(o)}else if(1==i)break;return e.moves=r,e}function addToDex(e){var t={};void 0==SETDEX_SM[e.name]&&(SETDEX_SM[e.name]={}),void 0==SETDEX_XY[e.name]&&(SETDEX_XY[e.name]={}),void 0==SETDEX_BW[e.name]&&(SETDEX_BW[e.name]={}),void 0==SETDEX_DPP[e.name]&&(SETDEX_DPP[e.name]={}),void 0==SETDEX_ADV[e.name]&&(SETDEX_ADV[e.name]={}),void 0==SETDEX_GSC[e.name]&&(SETDEX_GSC[e.name]={}),void 0==SETDEX_RBY[e.name]&&(SETDEX_RBY[e.name]={}),void 0!==e.ability&&(t.ability=e.ability),t.level=e.level,t.evs=e.evs,t.ivs=e.ivs,t.moves=e.moves,t.nature=e.nature,t.item=e.item,localStorage.customsets?customsets=JSON.parse(localStorage.customsets):customsets={},customsets[e.name]||(customsets[e.name]={}),customsets[e.name][e.nameProp]=t,"Aegislash-Blade"==e.name&&(customsets["Aegislash-Shield"]||(customsets["Aegislash-Shield"]={}),customsets["Aegislash-Shield"][e.nameProp]=t),updateDex(customsets)}function updateDex(e){for(pokemon in e)for(moveset in e[pokemon])SETDEX_SM[pokemon]||(SETDEX_SM[pokemon]={}),SETDEX_SM[pokemon][moveset]=e[pokemon][moveset],SETDEX_XY[pokemon]||(SETDEX_XY[pokemon]={}),SETDEX_XY[pokemon][moveset]=e[pokemon][moveset],SETDEX_BW[pokemon]||(SETDEX_BW[pokemon]={}),SETDEX_BW[pokemon][moveset]=e[pokemon][moveset],SETDEX_DPP[pokemon]||(SETDEX_DPP[pokemon]={}),SETDEX_DPP[pokemon][moveset]=e[pokemon][moveset],SETDEX_ADV[pokemon]||(SETDEX_ADV[pokemon]={}),SETDEX_ADV[pokemon][moveset]=e[pokemon][moveset],SETDEX_GSC[pokemon]||(SETDEX_GSC[pokemon]={}),SETDEX_GSC[pokemon][moveset]=e[pokemon][moveset],SETDEX_RBY[pokemon]||(SETDEX_RBY[pokemon]={}),SETDEX_RBY[pokemon][moveset]=e[pokemon][moveset];localStorage.customsets=JSON.stringify(e)}function addSets(e){var t,a,r=e.split("\n"),s=0;for(i=0;i<r.length;i++)for(t=r[i].split(/[\(\)@]/),j=0;j<t.length;j++)t[j]=checkExeptions(t[j].trim()),void 0!==POKEDEX_SM[t[j].trim()]&&((a=POKEDEX_SM[t[j].trim()]).name=t[j].trim(),a.item=getItem(t,j+1),1===j?a.nameProp=t[j-1].trim():a.nameProp="Custom Set",a.ability=getAbility(r[i+1].split(":")),addToDex(a=getMoves(a=getStats(a,r,i+1),r,i)),s++);s>0?(alert("Successfully imported "+s+" set(s)"),$("#clearSets").css("display","inline")):alert("No sets imported, please check your syntax and try again")}function checkExeptions(e){switch(e){case"Aegislash":e="Aegislash-Blade";break;case"Araquanid-Totem":e="Araquanid";break;case"Basculin-Blue-Striped":e="Basculin";break;case"Gumshoos-Totem":e="Gumshoos";break;case"Keldeo-Resolute":e="Keldeo";break;case"Kommo-o-Totem":e="Kommo-o";break;case"Lurantis-Totem":e="Lurantis";break;case"Marowak-Alola-Totem":e="Marowak-Alola";break;case"Mimikyu-Totem":case"Mimikyu-Busted":e="Mimikyu";break;case"Pikachu-Alola":case"Pikachu-Belle":case"Pikachu-Cosplay":case"Pikachu-Hoenn":case"Pikachu-Kalos":case"Pikachu-Libre":case"Pikachu-Original":case"Pikachu-Partner":case"Pikachu-PhD":case"Pikachu-Pop-Star":case"Pikachu-Rock-Star":case"Pikachu-Sinnoh":case"Pikachu-Unova":e="Pikachu";break;case"Raticate-Alola-Totem":e="Raticate-Alola";break;case"Ribombee-Totem":e="Ribombee";break;case"Salazzle-Totem":e="Salazzle";break;case"Vikavolt-Totem":e="Vikavolt";break;case"Vivillon-Fancy":case"Vivillon-Pokeball":e="Vivillon"}return e}var bounds={level:[0,100],base:[1,255],evs:[0,252],ivs:[0,31],dvs:[0,15],"move-bp":[0,999]};for(var bounded in bounds)attachValidation(bounded,bounds[bounded][0],bounds[bounded][1]);$(".level").keyup(function(){var e=$(this).closest(".poke-info");calcHP(e),calcStats(e)}),$(".nature").bind("keyup change",function(){calcStats($(this).closest(".poke-info"))}),$(".hp .base, .hp .evs, .hp .ivs").bind("keyup change",function(){calcHP($(this).closest(".poke-info"))}),$(".at .base, .at .evs, .at .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"at")}),$(".df .base, .df .evs, .df .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"df")}),$(".sa .base, .sa .evs, .sa .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"sa")}),$(".sd .base, .sd .evs, .sd .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"sd")}),$(".sp .base, .sp .evs, .sp .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"sp")}),$(".sl .base").keyup(function(){calcStat($(this).closest(".poke-info"),"sl")}),$(".at .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"at"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".df .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"df"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".sa .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"sa"),e.find(".sd .dvs").val($(this).val()),calcStat(e,"sd"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".sp .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"sp"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".sl .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"sl"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".current-hp").keyup(function(){var e=$(this).parent().children(".max-hp").text();validate($(this),0,e);var t=$(this).val();calcPercentHP($(this).parent(),e,t)}),$(".percent-hp").keyup(function(){var e=$(this).parent().children(".max-hp").text();validate($(this),0,100);var t=$(this).val();calcCurrentHP($(this).parent(),e,t)}),$(".ability").bind("keyup change",function(){$(this).closest(".poke-info").find(".move-hits").val("Skill Link"===$(this).val()?5:3)}),$("#p1 .ability").bind("keyup change",function(){autosetWeather($(this).val(),0),autosetTerrain($(this).val(),0)});var lastManualWeather="",lastAutoWeather=["",""],lastManualTerrain="",lastAutoTerrain=["",""];$("#p1 .item").bind("keyup change",function(){autosetStatus("#p1",$(this).val())});var lastManualStatus={"#p1":"Healthy"},lastAutoStatus={"#p1":"Healthy"};$(".status").bind("keyup change",function(){"Badly Poisoned"===$(this).val()?$(this).parent().children(".toxic-counter").show():$(this).parent().children(".toxic-counter").hide()}),$(".move-selector").change(function(){var e=$(this).val(),t=moves[e]||moves["(No Move)"],a=$(this).parent();a.children(".move-bp").val(t.bp),a.children(".move-type").val(t.type),a.children(".move-cat").val(t.category),a.children(".move-crit").prop("checked",!0===t.alwaysCrit),t.isMultiHit?(a.children(".move-hits").show(),a.children(".move-hits").val("Skill Link"===$(this).closest(".poke-info").find(".ability").val()?5:3),a.children(".move-hits").val("Grip Claw"===$(this).closest(".poke-info").find(".item").val()?5:3)):a.children(".move-hits").hide(),a.children(".move-z").prop("checked",!1)}),$(".set-selector").change(function(){var e,t,a=$(this).val();e=a.substring(0,a.indexOf(" (")),t=a.substring(a.indexOf("(")+1,a.lastIndexOf(")"));var i=pokedex[e];if(i){var r=$(this).closest(".poke-info");stickyMoves.getSelectedSide()===r.prop("id")&&stickyMoves.clearStickyMove(),r.find(".type1").val(i.t1),r.find(".type2").val(i.t2),r.find(".hp .base").val(i.bs.hp);var s;for(s=0;s<STATS.length;s++)r.find("."+STATS[s]+" .base").val(i.bs[STATS[s]]);r.find(".weight").val(i.w),r.find(".boost").val(0),r.find(".percent-hp").val(100),r.find(".status").val("Healthy"),$(".status").change();var o,n=r.find(".ability"),l=r.find(".item");if(e in setdex&&t in setdex[e]){var c=setdex[e][t];for(r.find(".level").val(c.level),r.find(".hp .evs").val(c.evs&&void 0!==c.evs.hp?c.evs.hp:0),r.find(".hp .ivs").val(c.ivs&&void 0!==c.ivs.hp?c.ivs.hp:31),r.find(".hp .dvs").val(c.dvs&&void 0!==c.dvs.hp?c.dvs.hp:15),s=0;s<STATS.length;s++)r.find("."+STATS[s]+" .evs").val(c.evs&&void 0!==c.evs[STATS[s]]?c.evs[STATS[s]]:0),r.find("."+STATS[s]+" .ivs").val(c.ivs&&void 0!==c.ivs[STATS[s]]?c.ivs[STATS[s]]:31),r.find("."+STATS[s]+" .dvs").val(c.dvs&&void 0!==c.dvs[STATS[s]]?c.dvs[STATS[s]]:15);for(setSelectValueIfValid(r.find(".nature"),c.nature,"Hardy"),setSelectValueIfValid(n,i.ab?i.ab:c.ability,""),setSelectValueIfValid(l,c.item,""),s=0;s<4;s++)setSelectValueIfValid(o=r.find(".move"+(s+1)+" select.move-selector"),c.moves[s],"(No Move)"),o.change()}else{for(r.find(".level").val(100),r.find(".hp .evs").val(0),r.find(".hp .ivs").val(31),r.find(".hp .dvs").val(15),s=0;s<STATS.length;s++)r.find("."+STATS[s]+" .evs").val(0),r.find("."+STATS[s]+" .ivs").val(31),r.find("."+STATS[s]+" .dvs").val(15);for(r.find(".nature").val("Hardy"),setSelectValueIfValid(n,i.ab,""),l.val(""),s=0;s<4;s++)(o=r.find(".move"+(s+1)+" select.move-selector")).val("(No Move)"),o.change()}if("function"==typeof getSelectedTiers){var d=getSelectedTiers()[0];"LC"===d&&r.find(".level").val(5),_.startsWith(d,"VGC")&&r.find(".level").val(50)}var h=$(this).siblings().find(".forme").parent();l.prop("disabled",!1),i.formes?showFormes(h,t,e,i):h.hide(),calcHP(r),calcStats(r),n.change(),l.change()}}),$(".forme").change(function(){var e=pokedex[$(this).val()],t=$(this).closest(".info-group").siblings(),a=t.find(".select2-chosen").first().text();a.substring(0,a.indexOf(" (")),a.substring(a.indexOf("(")+1,a.lastIndexOf(")"));$(this).parent().siblings().find(".type1").val(e.t1),$(this).parent().siblings().find(".type2").val(void 0!==e.t2?e.t2:""),$(this).parent().siblings().find(".weight").val(e.w);for(var i=0;i<STATS.length;i++){var r=t.find("."+STATS[i]).find(".base");r.val(e.bs[STATS[i]]),r.keyup()}abilities.indexOf(e.ab)>-1?t.find(".ability").val(e.ab):t.find(".ability").val(""),t.find(".ability").keyup(),0===$(this).val().indexOf("Mega")&&"Rayquaza-Mega"!==$(this).val()?t.find(".item").val("").keyup():t.find(".item").prop("disabled",!1)});var gen,genWasChanged,notation,pokedex,setdex,typeChart,moves,abilities,items,STATS,calcHP,calcStat;$(".gen").change(function(){switch(gen=~~$(this).val(),genWasChanged=!0,gen){case 1:pokedex=POKEDEX_RBY,setdex=SETDEX_RBY,typeChart=TYPE_CHART_RBY,moves=MOVES_RBY,items=[],abilities=[],STATS=STATS_RBY,calcHP=CALC_HP_RBY,calcStat=CALC_STAT_RBY;break;case 2:pokedex=POKEDEX_GSC,setdex=SETDEX_GSC,typeChart=TYPE_CHART_GSC,moves=MOVES_GSC,items=ITEMS_GSC,abilities=[],STATS=STATS_GSC,calcHP=CALC_HP_RBY,calcStat=CALC_STAT_RBY;break;case 3:pokedex=POKEDEX_ADV,setdex=SETDEX_ADV,typeChart=TYPE_CHART_GSC,moves=MOVES_ADV,items=ITEMS_ADV,abilities=ABILITIES_ADV,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;case 4:pokedex=POKEDEX_DPP,setdex=SETDEX_DPP,typeChart=TYPE_CHART_GSC,moves=MOVES_DPP,items=ITEMS_DPP,abilities=ABILITIES_DPP,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;case 5:pokedex=POKEDEX_BW,setdex=SETDEX_BW,typeChart=TYPE_CHART_GSC,moves=MOVES_BW,items=ITEMS_BW,abilities=ABILITIES_BW,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;case 6:pokedex=POKEDEX_XY,setdex=SETDEX_XY,typeChart=TYPE_CHART_XY,moves=MOVES_XY,items=ITEMS_XY,abilities=ABILITIES_XY,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;default:pokedex=POKEDEX_SM,setdex=SETDEX_SM,typeChart=TYPE_CHART_XY,moves=MOVES_SM,items=ITEMS_SM,abilities=ABILITIES_SM,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV}clearField(),$("#importedSets").prop("checked",!1),loadDefaultList(),$(".gen-specific.g"+gen).show(),$(".gen-specific").not(".g"+gen).hide();var e=getSelectOptions(Object.keys(typeChart));$("select.type1, select.move-type").find("option").remove().end().append(e),$("select.type2").find("option").remove().end().append('<option value="">(none)</option>'+e);var t=getSelectOptions(Object.keys(moves),!0);$("select.move-selector").find("option").remove().end().append(t);var a=getSelectOptions(abilities,!0);$("select.ability").find("option").remove().end().append('<option value="">(other)</option>'+a);var i=getSelectOptions(items,!0);$("select.item").find("option").remove().end().append('<option value="">(none)</option>'+i),$(".set-selector").val(getSetOptions()[gen<3?3:1].id),$(".set-selector").change()}),$(".notation").change(function(){notation=$(this).val()});var stickyMoves=function(){var e="resultMoveL1";return $(".result-move").click(function(){this.id===e?$(this).toggleClass("locked-move"):$(".locked-move").removeClass("locked-move"),e=this.id}),{clearStickyMove:function(){e=null,$(".locked-move").removeClass("locked-move")},setSelectedMove:function(t){e=t},getSelectedSide:function(){if(e){if(-1!==e.indexOf("resultMoveL"))return"p1";if(-1!==e.indexOf("resultMoveR"))return"p2"}return null}}}();$(document).ready(function(){$("#gen7").prop("checked",!0),$("#gen7").change(),$("#percentage").prop("checked",!0),$("#percentage").change(),loadDefaultList(),$(".move-selector").select2({dropdownAutoWidth:!0,matcher:function(e,t){return 0===t.toUpperCase().indexOf(e.toUpperCase())||t.toUpperCase().indexOf(" "+e.toUpperCase())>=0}}),$(".set-selector").val(getSetOptions()[gen<3?3:1].id),$(".set-selector").change(),$(".terrain-trigger").bind("change keyup",getTerrainEffects)}),$("#p2 .ability").bind("keyup change",function(){autosetWeather($(this).val(),1),autosetTerrain($(this).val(),1)}),$("#p2 .item").bind("keyup change",function(){autosetStatus("#p2",$(this).val())}),lastManualStatus["#p2"]="Healthy",lastAutoStatus["#p1"]="Healthy";for(var resultLocations=[[],[]],i=0;i<4;i++)resultLocations[0].push({move:"#resultMoveL"+(i+1),damage:"#resultDamageL"+(i+1)}),resultLocations[1].push({move:"#resultMoveR"+(i+1),damage:"#resultDamageR"+(i+1)});var damageResults;$(".result-move").change(function(){if(damageResults){var e,t,a=findDamageResult($(this)),i=new Pokemon($("#p1")),r=new Pokemon($("#p2")),s=this.id.match(/\d+/)-1;a&&($("#mainResult").text(a.description+": "+a.damageText+" -- "+a.koChanceText),$("#damageValues").text("Possible damage amounts: ("+a.damage.join(", ")+")"),$("#simpleMain").text("Damage: "+a.damageText),$("#simpleKO").text("KO Chance: "+a.koChanceText),this.id.match(/L/)?(e=a.damage[0]*i.moves[s].hits,t=a.damage[a.damage.length-1]*i.moves[s].hits,updateBar(100-Math.floor(1e3*e/r.maxHP)/10,100-Math.floor(1e3*t/r.maxHP)/10,1)):(e=a.damage[0]*r.moves[s].hits,t=a.damage[a.damage.length-1]*r.moves[s].hits,updateBar(100-Math.floor(1e3*e/i.maxHP)/10,100-Math.floor(1e3*t/i.maxHP)/10,2)),changeSprite(i.name,1),changeSprite(r.name,2))}});var calculateAllMoves;$(".gen").change(function(){switch(gen){case 1:calculateAllMoves=CALCULATE_ALL_MOVES_RBY;break;case 2:calculateAllMoves=CALCULATE_ALL_MOVES_GSC;break;case 3:calculateAllMoves=CALCULATE_ALL_MOVES_ADV;break;case 4:calculateAllMoves=CALCULATE_ALL_MOVES_DPP;break;default:calculateAllMoves=CALCULATE_ALL_MOVES_BW}}),$(".mode").change(function(){window.location.replace("honkalculate.html?mode="+$(this).attr("id"))}),$(".notation").change(function(){calculate()}),$(document).ready(function(){$(".calc-trigger").bind("change keyup",function(){setTimeout(calculate,0)}),calculate()}),$(".result-move").click(function(){$(".btn-move").removeClass("move-selected"),$(this).parent(".btn-move").addClass("move-selected")}),$("#show-btn").click(function(){$("#show-details").toggle()}),$("#close-btn").click(function(){$("#show-details").toggle()}),$("#field-open-btn").click(function(){$("#field-popup").toggle()}),$("#field-close-btn").click(function(){$("#field-popup").toggle()}),$("#import-open-btn").click(function(){$("#import-popup").toggle()}),$("#import-close-btn").click(function(){$("#import-popup").toggle()});var focusedElement;$(document).on("focus","input",function(){focusedElement!=this&&(focusedElement=this,setTimeout(function(){focusedElement.select()},50))}),$("#clearSets").click(function(){localStorage.removeItem("customsets"),alert("Custom Sets successfully cleared. Please refresh the page."),$("#clearSets").css("display","none"),$("#importedSetsOptions").css("display","none"),loadDefaultList()}),$("#importedSets").click(function(){$(this).prop("checked")?loadCustomList():loadDefaultList()});var customSets;$(document).ready(function(){placeBsBtn(),localStorage.customsets?(updateDex(customSets=JSON.parse(localStorage.customsets)),$("#importedSetsOptions").css("display","inline")):loadDefaultList()});